(()=>{"use strict";var e,s={91512:(e,s,t)=>{var o=t(72844),i=t(20628),a=t(9534),r=t(73568),n=t(64952),l=t(64140),d=t(47051),c=t(23184),u=t(32008),h=t(53140),p=t(78160),P=t(52576),S=t(79236);Panopto.Core.Analytics=Panopto.Core.Analytics||{},Panopto.UI=Panopto.UI||{},Panopto.Viewer=Panopto.Viewer||{},Type.registerNamespace("Panopto"),Panopto.SessionList=function(e){this.folderForFileDrop={},this.fileDragOverHoverCount=0,this.config=o.defaults(e,{showCreatorTour:!1}),Panopto.SessionList.initializeBase(this,["GetSessions"]),Panopto.SessionList.defaultInstance=this,this._defaultSortColumn=Panopto.Data.SessionColumns.Date,this._defaultSortAscending=!1,this._defaultSearchColumn=Panopto.Data.SessionColumns.Relevance,this._specificSortDefault=null,this.queryParams.folderID=null,this.queryParams.status=null,this.queryParams.bookmarked=!1,this.queryParams.sortColumn=this._defaultSortColumn,this.queryParams.sortAscending=this._defaultSortAscending,this.queryParams.getFolderData=!1,this.queryParams.isSharedWithMe=!1,this.queryParams.isSubscriptionsPage=!1,this.queryParams.subscribableTypes=null,this.queryParams.includeArchived=null,this.queryParams.includeArchivedStateCount=!1,this.queryParams.sessionListOnlyArchived=!1,this.parentFolderID=null,this._viewSetting="lastSessionView",this._defaultSortSettingName="lastSessionSort",this._searchSortSettingName="lastSessionWithSearchSort",this._hasBatchDeleteButton=Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionDelete]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.PlaylistDelete],this._hasBatchEditButton=!0,this._hasBatchShareButton=Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionShareAccessControlPolicyEnumerate],this._deleteMessage=Panopto.GlobalResources.SessionList_js_ConfirmDeleteSession,this._batchDeleteMessage=Panopto.GlobalResources.SessionList_js_SessionsSelected,this._searchWatermark=Panopto.GlobalResources.SessionList_js_SearchAllSessions,this._taskStatuses=[],this._pollStatusesInterval=null,this._creatorDeliveryIds=[],this._deliveries=[],this._retryStatusCall=!0,this._retryPolling=4,this._trackedCompletions={},this._headerActionButtons=null,this.previewPane=null,this.previewPaneDeliveryResults=[],this.selectedDeliveryResult=null,this.selectedContextResult=null,this.showGutters=!1,this._availableActionButtons={addShare:!0,addStats:!0,addNotes:!0,addSettings:!0,addDelete:!0,addEdit:!0,addLog:!1,addPublish:!0,addRestoreFromArchive:!0,addJoin:!0,addArchivedLog:!1},this._siteBrandAccentColor=Panopto.branding.accentColor,this._siteBrandWebLogoUrl=Panopto.branding.largeLogo.png,Sys.converters.displayColumnName=Panopto.Data.SessionColumns.getDisplayName,Sys.converters.displayStatus=Panopto.Data.SessionStatus.getDisplayName,this._navBarInstance=e.navBarInstance,this._createMenu=e.createMenuInstance,this.dragManager=Panopto.NavBar.defaultInstance.dragManager,this._previewUserSetting="videoPreviewEnabled",this.previewToggleShown=Panopto.list.showVideoPreview&&Panopto.user.userKey&&!Panopto.isEmbedded,this.previewModeEnabled=this.previewToggleShown&&(0,r.getUserSetting)(this._previewUserSetting),document.getElementById("resultsDiv")?.addEventListener("scroll",(()=>this._openMoreMenuThumbnail?.setProps({isMoreMenuOpen:!1})),{capture:!0})},Panopto.SessionList.cExportServiceUrl=Panopto.appRoot+"/Services/Export.ashx",Panopto.SessionList.cExportMethodName="ExportDeliveries",Panopto.SessionList.Constants={FolderPickerNoSelectionClass:"no-selection-everything"},Panopto.SessionList.prototype={_saveOperation:"SaveSessions",_deleteOperation:"DeleteSessions",_getID:function(e){return e.DeliveryID},_deleteMessage:null,_batchDeleteMessage:null,_navBarInstance:null,_createMenu:null,_gridViewEnabled:!0,_folderDataByID:{},_lastStatusCallId:0,_folderPicker:null,_subscriptionEmptyMessage:void 0,_columnData:[{column:-1,cssClass:"session-list-processing",sortSettings:{sortable:!1,showInTableView:!0,showInListView:!1}},{column:Panopto.Data.SessionColumns.Site,cssClass:"list-site",sortSettings:{showInTableView:Panopto.showAffiliation,showInListView:Panopto.isHostedMaster}},{column:Panopto.Data.SessionColumns.Order,cssClass:"list-order",sortSettings:{showInTableView:!1,showInListView:!1}},{column:Panopto.Data.SessionColumns.SessionName,cssClass:"session-list-name"},{column:Panopto.Data.SessionColumns.RemoteRecorder,cssClass:"sessions-rr",sortSettings:{showInTableView:!1,showInListView:!1}},{column:Panopto.Data.SessionColumns.Status,cssClass:"sessions-status",sortSettings:{showInTableView:!1,showInListView:!1}},{column:Panopto.Data.SessionColumns.Duration,cssClass:"list-length",sortSettings:{defaultAscending:!1}},{column:Panopto.Data.SessionColumns.Date,cssClass:"list-date sessions-date",sortSettings:{defaultAscending:!1}},{column:Panopto.Data.SessionColumns.SharedWithMeDate,cssClass:"list-date shared-with-me-date",sortSettings:{showInTableView:!1,showInListView:!1,defaultAscending:!1}},{column:Panopto.Data.SessionColumns.FolderName,cssClass:"list-folder",sortSettings:{showInTableView:!1,showInListView:!1}},{column:Panopto.Data.SessionColumns.Rating,cssClass:"sessions-rating",sortSettings:{showInTableView:Panopto.features.areRatingsEnabled,showInListView:Panopto.features.areRatingsEnabled,defaultAscending:!1}},{column:Panopto.Data.SessionColumns.Relevance,cssClass:"list-relevance",sortSettings:{showInTableView:!1,showInListView:!1,defaultAscending:!1,forceDirection:"descending"}}],_subfolderList:null,_dragImage:void 0,_showCheckboxes:Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionDelete]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.PlaylistDelete]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionCopySource]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionReferenceSource]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionMoveSource]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionAccessControlPolicyEdit],dragManager:void 0,_headerComponent:null,init:function(){S.I.closePopoverLoginPageInTeamsApp(),Panopto.SessionList.callBaseMethod(this,"init",[{showDateFilter:!0}]),this.previewModeEnabled&&this.togglePreviewPane(!0),$("#embeddedSessionsButton").addClass("accent-color").attr("aria-current","page"),Panopto.Core.UI.Handlers.button($("#parentFolderButton").add("#parentFolderButtonInHeader"),(()=>{this.parentFolderID&&Panopto.SessionList.navigateToPageState({folderID:this.parentFolderID})}),{context:this}),this._subfolderList=Panopto.Core.UI.Components.SubfolderList("#subfolderBar","#resultsDiv",{ErrorAddingFolder:Panopto.GlobalResources.Sessions_List_ErrorAddingFolder,DuplicateFolderName:Panopto.GlobalResources.Sessions_List_DuplicateFolderName,FolderNameTooLong:Panopto.GlobalResources.Sessions_List_FolderNameTooLong},{addFileDropTarget:(e,s,t)=>{Panopto.features.copyrightWarningForUploadsEnabled||new P.w(e,t,(({isHovered:e})=>{this.onFileDragHoverChange(s,t,{isHovered:e,isSubfolder:!0})}),(()=>this.onValidateFileDrag(s,t,{isSubfolder:!0})))},onFolderClick:e=>{Panopto.SessionList.navigateToPageState({folderID:e})},onFolderAdded:e=>{this._navBarInstance.refresh()}}),this._attachNavbarHandlers(),Panopto.isEmbedded||($("#headerWrapper").show(),$("#oldHeader, #headerActionButtonsPlaceholder, #searchHeader").hide(),$("#refreshButton").hide(),this._headerComponent=(0,n.bootstrapReactComponent)(u.s)($("#headerWrapper")[0],{title:"",onRefresh:()=>this.updateData(!1),onParentFolderNavigate:()=>{this.parentFolderID&&Panopto.SessionList.navigateToPageState({folderID:this.parentFolderID})},resources:Panopto.GlobalResources})),this._headerActionButtons=new d.U({folderId:this.queryParams.folderID,popoutAnalyticsEvent:"embedded-folderlist-popout",target:$("#headerActionButtonsPlaceholder"),panoptoGlobal:Panopto}),$("#actionHeader").show(),$("#archivedFooterContainer").show(),this.archivedFooter=(0,n.bootstrapReactComponent)(h.g)($("#archivedFooterContainer")[0],{archivedCount:0,resources:Panopto.GlobalResources,isVisible:!1,isBackgroundShaded:Panopto.isEmbedded,onClickShowArchived:()=>{this._sessionFiltersProps={...this._sessionFiltersProps,showArchivedSessions:!0},this._actionHeader.setProps({sessionFiltersProps:this._sessionFiltersProps}),this.archivedFooter.setProps({isVisible:!1}),this.queryParams.sessionListOnlyArchived=!0,this.updateData()}}),this._subscriptionsFiltersProps={onSubscriptionsFiltersChanged:({peopleShown:e,foldersShown:s,tagsShown:t})=>{const o=[];s&&o.push(Panopto.Core.SubscribableType.SessionGroup),e&&o.push(Panopto.Core.SubscribableType.User),t&&o.push(Panopto.Core.SubscribableType.Tag),Panopto.Application.defaultInstance.updateState({subscribableTypes:o})}},Panopto.Core.UI.Handlers.button($("#subscriptionSettingsLink"),(()=>{Panopto.Application.defaultInstance.updateState({modalPage:"UserSubscriptions",modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({publicId:Panopto.user.userId})})})),this._sessionFiltersProps={scheduledToggleShown:!1,includeScheduledSessions:!1,onIncludeScheduledSessionsChanged:e=>{const s=e?Panopto.Data.StatusSets.All:null;Panopto.Application.defaultInstance.updateState({status:s,page:null})},archivedToggleShown:!1,readyToViewCount:0,archivedCount:0,showArchivedSessions:!1,onShowArchivedSessionsChanged:e=>{this._sessionFiltersProps={...this._sessionFiltersProps,showArchivedSessions:e},this._actionHeader.setProps({sessionFiltersProps:this._sessionFiltersProps}),this.queryParams.sessionListOnlyArchived=e,this.updateData()},searchArchivedToggleShown:!1,searchArchivedSessions:!0,onSearchArchivedSessionsChanged:e=>{this._sessionFiltersProps={...this._sessionFiltersProps,searchArchivedSessions:e},this._actionHeader.setProps({sessionFiltersProps:this._sessionFiltersProps});const s=!!e&&null;Panopto.Application.defaultInstance.updateState({includeArchived:s,page:null})},searchSubfoldersToggleShown:!1,searchSubfolders:!0,onSearchSubfoldersChanged:e=>{const s=!!e&&null;Panopto.Application.defaultInstance.updateState({searchSubfolders:s,page:null})}},this._actionHeader.setProps({showSort:!0,subscriptionFiltersProps:this._subscriptionsFiltersProps,showSessionFilters:!0,showDateFilter:!1,sessionFiltersProps:this._sessionFiltersProps,showViewToggle:!this._forceGridView,showPreviewButton:this.previewToggleShown,previewModeEnabled:this.previewModeEnabled,onPreviewModeToggle:()=>{this.previewModeEnabled=!this.previewModeEnabled,(0,r.setUserSetting)(this._previewUserSetting,this.previewModeEnabled),this.togglePreviewPane(this.previewModeEnabled)}}),$(".action-buttons, #detailsHeader").hide(),this.setFolder(null),Panopto.Application.defaultInstance.add_navigate(((e,s)=>this._handleNavigate(e,s))),this.config.showCreatorTour&&!Panopto.isEmbedded?Panopto.UI.GuidedTour.startCreatorTour():this.config.showAdminSettingsPrompt&&!Panopto.isEmbedded&&Panopto.UI.GuidedTour.promptAdminForContactInfoTour(this.config.adminHelpSettingsUrl),this.config.showViewerTour&&!Panopto.isEmbedded&&Panopto.UI.GuidedTour.startViewerTour(),Panopto.features.copyrightWarningForUploadsEnabled||(new P.w($("#resultsDiv"),this.folderForFileDrop,(({isHovered:e})=>{this.onFileDragHoverChange($(".drop-target-overlay"),this.folderForFileDrop,{isHovered:e})}),(()=>this.onValidateFileDrag($(".drop-target-overlay"),this.folderForFileDrop))),new P.w($(document),{},(()=>{}),(()=>!1))),$(".drop-target-overlay").show(),new Panopto.FileUploadController($("#fileUploadController")[0],{sessionService:Panopto.Core.ServiceInterface.SessionManagement,uploadManager:Panopto.features.uploadApiEnabledForStreamUpload&&Panopto.features.useUploadAPIForWebUpload?Panopto.Core.ServiceInterface.UploadV2.MultipartUploadManager:Panopto.Core.ServiceInterface.MultipartUploadManager,settings:{uploadByteLimit:Panopto.features.uploadByteLimit},resources:Panopto.GlobalResources,onSessionListUpdate:()=>this.updateData(!1,!1,null),onFolderNavigate:e=>{Panopto.SessionList.navigateToPageState({folderID:e})},onSettingsNavigate:(e,s)=>{Panopto.Application.defaultInstance.updateState({modalPage:"SessionInfo",modalHeader:Panopto.Core.TextHelpers.innerText(s),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({id:e})})}})},_attachNavbarHandlers:function(){[{button:".my-folder a",state:{folderID:Panopto.user.sandboxFolderId}},{button:".subscriptions a",state:{isSubscriptionsPage:!0}},{button:".shared-with-me a",state:{isSharedWithMe:!0}},{button:".everything a",state:{}},{button:".in-progress a",state:{status:Panopto.Data.StatusSets.InProgress}},{button:".scheduled a",state:{status:Panopto.Data.StatusSets.Scheduled}},{button:".bookmarked a",state:{bookmarked:!0}}].forEach((({button:e,state:s})=>{Panopto.Core.UI.Handlers.button($(e),((e,t)=>{t.ctrlKey||t.shiftKey||t.metaKey||(jQuery.isEmptyObject(s)&&(this.allSessionsClicked=!0),Panopto.SessionList.navigateToPageState(s),t.preventDefault())}),{preserveExisting:!0,allowDefault:!0,allowPropagation:!0})}))},onFileDragHoverChange:function(e,s,{isHovered:t,isSubfolder:o=!1}){this.fileDragOverHoverCount+=t?1:-1,o&&e.toggleClass("dragover",t),$(".drop-target-overlay").toggleClass(o?"dragover-subfolder":"dragover",t),$(".subfolder-bar").toggleClass("session-list-dragover",this.fileDragOverHoverCount>0),t&&($(".drop-target-overlay .folder-name").text(s.name),$(".drop-target-overlay .folder-container .material-icons").toggle(!!s.id)),$("#fileUploadController").toggleClass("drag-active",this.fileDragOverHoverCount>0)},onValidateFileDrag:function(e,s,{isSubfolder:t=!1}={}){const o=Panopto.user.hasUnison&&!!s.id&&s.hasWriteAccess;return $(".drop-target-overlay").toggleClass("valid",o),t&&e.toggleClass("valid",o),o},togglePreviewPane:function(e){this._actionHeader.setProps({previewModeEnabled:e}),e?this.previewPane?this.previewPane.setProps(this.generatePreviewPaneProps()):this.previewPane=new Panopto.PreviewPaneFactory($("#contentPreviewWindow")[0],this.generatePreviewPaneProps()):this.previewPane&&(this.previewPane.setProps(this.generatePreviewPaneProps(!0)),$(".show-currently-playing").removeClass("show-currently-playing"),$(".previewed-result").removeClass("previewed-result")),$(".content-table").toggleClass("preview-pane-shown",e),$("#previewWindow").toggle(e),this._matchHeaderAndContentTableWidths()},setSelectedResult:function(e,s){this.selectedDeliveryResult=e,this.selectedContextResult=s,this.previewPane&&this.previewPane.setProps({selectedDeliveryResult:this.selectedDeliveryResult,selectedContextResult:this.selectedContextResult}),$("#listViewContainer .previewed-result").removeClass("previewed-result"),$("#listViewContainer .show-currently-playing").removeClass("show-currently-playing"),this.selectedDeliveryResult&&$("#"+this.selectedDeliveryResult.id).addClass("previewed-result"),this.selectedContextResult&&$("#"+this.selectedContextResult.id+" .currently-playing").addClass("show-currently-playing")},onSessionClick:function(e,s,t){if(Panopto.list.showVideoPreview&&this.previewModeEnabled){e.preventDefault(),this.togglePreviewPane(!0);const i=o.findWhere(this.previewPaneDeliveryResults,{id:s.DeliveryID});if(i){const e=t?o.findWhere(i.contextResults,{id:t.PublicId}):void 0;this.setSelectedResult(i,e)}}else S.I.isFromTeams&&(e.preventDefault(),S.I.onSessionViewClick(e,s));Panopto.GoogleAnalytics.sendSessionClickEvent()},generatePreviewPaneProps:function(e){return e&&(this.selectedDeliveryResult=null,this.selectedContextResult=null),{searchQuery:this.queryParams.query,deliveryResults:this.previewPaneDeliveryResults,selectedDeliveryResult:this.selectedDeliveryResult,selectedContextResult:this.selectedContextResult,onClosePreview:()=>this.togglePreviewPane(!1),resources:Panopto.GlobalResources,onSelectedResultChanged:(e,s)=>{this.setSelectedResult(e,s)}}},_handleNavigate:function(e,s){const t=s.get_state(),o=this.queryParams.query;t.query!=o&&(this._displaySearch(t.query),t.query||(this._sessionFiltersProps={...this._sessionFiltersProps,searchSubfoldersToggleShown:!1},this._actionHeader.setProps({sessionFiltersProps:this._sessionFiltersProps}))),Panopto.SessionList.callBaseMethod(this,"_handleNavigate",[e,s]);const i=!!t.isSharedWithMe,a=!!t.bookmarked,r=!!t.isSubscriptionsPage,n=t.folderID?.toLowerCase(),l=this.isMyFolder(n),d=this.queryParams.folderID;i===this.queryParams.isSharedWithMe&&a==this.queryParams.bookmarked&&r===this.queryParams.isSubscriptionsPage&&l==this.isMyFolder(this.queryParams.folderID)||(this.queryParams.isSharedWithMe=i,this.queryParams.bookmarked=a,this.queryParams.isSubscriptionsPage=r,this.queryParams.folderID=n,this._displayDesignerQuery(),this._isStale=!0),jQuery.isEmptyObject(t)&&!this.allSessionsClicked||(this.updatingFolderData=!1),this._renderTaskStatuses(),n!=d&&(n&&!this._folderDataByID[n]&&(this._folderDataByID[n]={ID:n,Name:Panopto.GlobalResources.Folder_Header_Loading,Role:null,ParentID:null,Count:0,PodcastEnabled:!1,FolderType:l?Panopto.Core.FolderType.Sandbox:Panopto.Core.FolderType.Normal,Permissions:[]},this.updateFolderData(n,!0)),this.setFolder(n),this._isStale=!0),this.queryParams.getFolderData=!!n,this.queryParams.includePlaylists=!0,Array.equals(t.status,this.queryParams.status)||(this.setStatus(t.status),this._isStale=!0),t.searchSubfolders!==this.queryParams.searchSubfolders&&(this.setSearchSubfolders(t.searchSubfolders),this._isStale=!0);const c=!1!==t.includeArchived;c!==this.queryParams.includeArchived&&(this.setIncludeArchived(c),this._isStale=!0),this.updateArchiveOptions(d,n,o,t.query),t.isSubscriptionsPage&&!t.subscribableTypes&&(t.subscribableTypes=[Panopto.Core.SubscribableType.SessionGroup,Panopto.Core.SubscribableType.User,Panopto.Core.SubscribableType.Tag]),Array.equals(t.subscribableTypes,this.queryParams.subscribableTypes)||(this.queryParams.subscribableTypes=t.subscribableTypes,this._subscriptionsFiltersProps={...this._subscriptionsFiltersProps,peopleShown:!!this.queryParams.subscribableTypes?.includes(Panopto.Core.SubscribableType.User),foldersShown:!!this.queryParams.subscribableTypes?.includes(Panopto.Core.SubscribableType.SessionGroup),tagsShown:!!this.queryParams.subscribableTypes?.includes(Panopto.Core.SubscribableType.Tag)},this._isStale=!0),$(".date-container").toggle(!this.queryParams.isSubscriptionsPage),this._actionHeader.setProps({showSort:!this.queryParams.isSubscriptionsPage,showDateFilter:!this.queryParams.isSubscriptionsPage,showSubscriptionFilters:this.queryParams.isSubscriptionsPage,subscriptionFiltersProps:this._subscriptionsFiltersProps}),this._isStale&&(this.updateData(),this._isStale=!1)},_renderTaskStatuses:function(){const e=this,s=o.groupBy(this._taskStatuses,"relatedDeliveryID"),t=o.template($("#statusTemplate").html()),i="not-viewable-message",a="availability-message",r="job-status",n=function(e){const s=o.invert(Panopto.Core.ServiceInterface.Objects.TaskState),t=e.state==Panopto.Core.ServiceInterface.Objects.TaskState.WaitingForData?s[Panopto.Core.ServiceInterface.Objects.TaskState.Unprocessed]:s[e.state],i=String.format("SessionList_{0}_{1}_Status",e.taskName,t),a=Panopto.GlobalResources[i]||Panopto.GlobalResources.SessionList_MissingStatusString,r=e.progress?Math.round(e.progress):0;let n=String.format(a,r,e.sourceFilename);if(e.isError()&&e.subState){const s=Panopto.ListBase.displaySubState(e);n+=Panopto.GlobalResources.SubStatus_SentenceSeparator+s}return n},l=function(e,s,t){const i=t.find(".status-item"),a=function(e){switch(e){case"AvailabilityMessage":return 0;case"UnisonPackaging":return 1;case"UnisonEncode":return 2;case"SlidePackaging":return 3;case"MediaPackaging":return 4;case"ViewerEncode":return 5;case"FastPathViewerEncode":return 6;case"PodcastEncode":return 7;case"TabletEncode":return 8;case"LegacyRecorderUpload":return 9;case"NotViewableMessage":return 10;case"ArchivedMessage":return 11;default:return 12}}(e),r=o.find(i,(function(e){return $(e).data("status-order")>a}));s.data("status-order",a),r?$(r).before(s):t.append(s)};o.each(s,(function(s){const i=$("#"+s[0].relatedDeliveryID).find(".status-message"),a=i.find(".status-item");o.each(a,(function(t){let i;const a=o.find(s,(function(e,s){return i=s,e.id===$(t).data("status-id")}));var r,l;a&&(r=a,l=e._trackedCompletions,r.isProcessing()&&void 0===l[r.id]&&(l[r.id]=Panopto.Core.Constants.CompletedExpiration),!r.isComplete()||(l[r.id]&&l[r.id]--,l[r.id]))?($(t).text(n(a)).toggleClass("error-status",a.isError()),s.splice(i,1)):$(t).remove()})),o.each(s,(function(e){if(!e.isComplete()){const s=$(t({createMessage:n(e),cssClass:r,isError:e.isError()}));s.data("status-id",e.id),l(e.taskName,s,i)}}))})),o.each(this._deliveries,(function(e){!function(e){if(e.Status===Panopto.Data.SessionStatus.Created&&e.Permissions[PanoptoTS.Core.Permission.SessionEnumerateAnyState]){const s=$("#"+e.DeliveryID).find(".status-message");let o=s.find("."+i);const a=s.find("."+r).length,n=e.HasStreams?Panopto.GlobalResources.SessionList_CreatedStatus_NoPrimaryStreams:e.IsBroadcast?Panopto.GlobalResources.SessionList_CreatedStatus_FutureWebcast:a?s.find("."+r):Panopto.GlobalResources.SessionList_CreatedStatus_NoStreams;o.length||a?o.toggle(!a).text(n):(o=$(t({createMessage:n,cssClass:i,isError:!1})),l("NotViewableMessage",o,s))}}(e),function(e){const s=$("#"+e.DeliveryID).find(".status-message");let o=s.find("."+a);e.AvailabilityMessage?o.length?o.text(e.AvailabilityMessage):(o=$(t({createMessage:e.AvailabilityMessage,cssClass:a,isError:!1})),l("AvailabilityMessage",o,s)):o&&o.remove()}(e)}))},_getStatusMessages:function(e){const s=this._lastStatusCallId+=1;let t,i;const n=e=>{o.each(e,(e=>{const s=Panopto.Core.ServiceInterface.Objects.DeliveryStatus(e),t=this._resultsDataContext._lastResults?o.findWhere(this._resultsDataContext._lastResults,{DeliveryID:s.id}):null,i=Panopto.Util.isViewable(s.status.SessionStatus)&&(!t||t.Permissions[PanoptoTS.Core.Permission.SessionView]),a=$("#"+s.id);if(a.find(".title-link").toggle(i),a.find(".title-span").toggle(!i),this._updateProcessIcon(a.find(".process-state-icon"),s.status.SessionStatus,s.status.IsReferenceCopy),t){const e=s.status.SessionStatus,o=s.status.IsEditable;t.Status===e&&t.IsEditable===o||(t.Status=e,t.IsEditable=o,this._reactThumbnailLookup[s.id]?.setProps({delivery:t}),this._addActionButtons(a,t,this._availableActionButtons))}}))};e&&(this._creatorDeliveryIDs=o.chain(e).filter((function(e){return e.Permissions[PanoptoTS.Core.Permission.SessionEnumerateAnyState]})).filter((e=>!e.IsArchived)).map((function(e){return e.DeliveryID})).value()),this._creatorDeliveryIDs.length&&(t=Panopto.Core.ServiceInterface.Objects.ServiceTaskQuery({filters:{deliveryIDs:this._creatorDeliveryIDs,includeDeliverySession:!0,serviceTaskTypeIDs:[Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.UnisonPackaging,Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.UnisonEncode],mostRecentServiceTaskTypeIDs:[Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.SlidePackaging,Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.MediaPackaging,Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.ViewerEncode,Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.FastPathViewerEncode,Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.PodcastEncode,Panopto.Core.ServiceInterface.Objects.ServiceTaskTypes.TabletEncode,Panopto.Core.ServiceInterface.Objects.ServiceTaskTypes.LegacyRecorderUpload,Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.TransferUpload,Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.CompleteUpload,Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.EmbedTranscript,Panopto.Core.ServiceInterface.Objects.ServiceTaskKinds.ConvertToOnDemand],taskStates:[Panopto.Core.ServiceInterface.Objects.TaskState.WaitingForData,Panopto.Core.ServiceInterface.Objects.TaskState.Unprocessed,Panopto.Core.ServiceInterface.Objects.TaskState.PullingDataFromServer,Panopto.Core.ServiceInterface.Objects.TaskState.Processing,Panopto.Core.ServiceInterface.Objects.TaskState.Transferring,Panopto.Core.ServiceInterface.Objects.TaskState.Failure,Panopto.Core.ServiceInterface.Objects.TaskState.Complete,Panopto.Core.ServiceInterface.Objects.TaskState.PermanentFailure]}}),(0,a.doFetchWcfApi)({methodName:"GetMatchingTaskStatusWebUI",data:{query:t},loadingIndicator:null}).then((e=>{if(s===this._lastStatusCallId&&(this._taskStatuses=o.map(e.ServiceTaskStatuses.Results,(function(e){return Panopto.Core.ServiceInterface.Objects.ServiceTaskStatus(e)})),this._renderTaskStatuses(),n(e.DeliveryStatuses)),this._creatorDeliveryIDs.length&&!this._pollStatusesInterval&&Panopto.statusPollingEnabled){let e=Date.now();this._pollStatusesInterval=setInterval((()=>{(!document.hidden||e+1e3*Panopto.list.intervalWhenHidden<Date.now())&&(e=Date.now(),this._getStatusMessages())}),Panopto.Core.Constants.PollStatusTime)}})).catch((e=>{500===e._statusCode&&(this._retryPolling--,this._retryPolling||(clearInterval(this._pollStatusesInterval),console&&r.Logging.Logger.warning("Status call failed too many times with code 500, stopping polling."))),this._retryStatusCall?(console&&r.Logging.Logger.warning("Status call failed, retrying.."),this._retryStatusCall=!1,this._getStatusMessages()):console&&r.Logging.Logger.warning("Status call failed")}))),e&&(i=o.chain(e).filter((function(e){return e.Permissions[PanoptoTS.Core.Permission.SessionManageApprovalState]})).map((function(e){return e.DeliveryID})).value(),i.length&&this._renderTaskStatuses())},_addActionButtons:function(...e){this._viewMode===Panopto.Data.ViewMode.Table&&Panopto.SessionList.callBaseMethod(this,"_addActionButtons",e)},_getItemName:function(e){return e.SessionName},_getDefaultSort:function(e){const s=e.isSharedWithMe&&this.config.showSharedWithMeDateSort&&this.config.defaultSharedWithMeDateSort&&(!e.query||this.config.showSharedWithMeSearchSort);return this._defaultSortColumn=s?Panopto.Data.SessionColumns.SharedWithMeDate:Panopto.Data.SessionColumns.Date,this._defaultSortColumn},_dataFetched:function(e){const s=this.queryParams.folderID;this.parentFolderID=e.ParentFolderId;const t=Boolean(s&&e.ContainsArchivedDeliveries&&Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.ViewArchive]&&!Panopto.isEmbedded);this._headerComponent?.setProps({showArchiveButton:t,isParentFolderButtonEnabled:!!this.parentFolderID});(this.config.showGoToParentButtonInEmbeddedSessionList&&Panopto.isEmbedded&&Panopto.embeddedModeView!==Panopto.Data.EmbeddedView.Mini||S.I.isFromTeams)&&$("#parentFolderButtonInHeader").toggle(!!s).toggleClass("disabled",!this.parentFolderID).attr("tabindex",this.parentFolderID?0:-1),s&&!this.queryParams.query&&Panopto.user.isAuthenticated&&(Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionEnumerateArchived]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionSearchArchivedViewableOnly]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionSearchArchivedViewableOnlyInFolderOnly])&&e.ArchivedCount?(this._sessionFiltersProps={...this._sessionFiltersProps,archivedToggleShown:!0,readyToViewCount:e.TotalNumber,archivedCount:e.ArchivedCount},this._actionHeader.setProps({sessionFiltersProps:this._sessionFiltersProps}),this.archivedFooter.setProps({archivedCount:e.ArchivedCount,isVisible:!0})):this.archivedFooter.setProps({isVisible:!1});const o=Boolean(s&&e.Subfolders&&e.Subfolders.length&&this.queryParams.query);this._sessionFiltersProps={...this._sessionFiltersProps,searchSubfoldersToggleShown:o},this._actionHeader.setProps({sessionFiltersProps:this._sessionFiltersProps});const i=this.queryParams.isSharedWithMe&&this.config.showSharedWithMeDateSort&&(!this.queryParams.query||this.config.showSharedWithMeSearchSort),a=this._getColumnData(Panopto.Data.SessionColumns.SharedWithMeDate).sortSettings;this._sortHeaderStale||(this._sortHeaderStale=i!==Panopto.SessionList.showSharedWithMeColumn),Panopto.SessionList.showSharedWithMeColumn=i,a.showInTableView=i,a.showInListView=i;const r=o&&!1!==this.queryParams.searchSubfolders,n=!s||r,l=this._getColumnData(Panopto.Data.SessionColumns.FolderName).sortSettings;this._sortHeaderStale||(this._sortHeaderStale=n!==Panopto.SessionList.showFolderNameColumn),Panopto.SessionList.showFolderNameColumn=n,l.showInTableView=n,l.showInListView=n,this._sortHeaderStale&&(this._sortHeaderDataView.refresh(),this._sortDropDownProps={...this._sortDropDownProps,sortOptions:this._getSortOptions()},this._actionHeader.setProps({sortDropDownProps:this._sortDropDownProps})),s?(this._subfolderList.show(!!e.Subfolders.length||e.CanAddSubfolder),this._subfolderList.setData({folderId:s,folderType:e.FolderType,addFolderEnabled:e.CanAddSubfolder,subfolders:e.Subfolders})):this._subfolderList.show(!1),this.showGutters=!1,this._openMoreMenuThumbnail?.setProps({isMoreMenuOpen:!1}),this._reactThumbnailLookup={},Panopto.SessionList.callBaseMethod(this,"_dataFetched",[e]),this.showGutters?$(".content-table, #sortHeaderDataView").addClass("show-gutters"):$(".show-gutters").removeClass("show-gutters"),this._deliveries=e.Results,this._getStatusMessages(this._deliveries),this.previewPaneDeliveryResults.length=0;for(const e of this._deliveries){const s={id:e.DeliveryID,name:e.SessionName,isPlaylist:e.PlayableObjectType===Panopto.Core.PlayableObjectType.Playlist,contextResults:[]};for(const t of e.Context)s.contextResults.push({id:t.PublicId,time:t.Time});this.previewPaneDeliveryResults.push(s)}this.togglePreviewPane(Panopto.list.showVideoPreview&&this.previewModeEnabled)},_updateProcessIcon:function(e,s,t){const o=Panopto.Data.SessionStatus.getIcon(s,t);e.title=o.title,e.alt=o.title;const i=document.createElement("img");i.crossOrigin="",i.setAttribute("src",`${Panopto.cacheRoot}/${o.svgUrl}`),document.createElement("div").appendChild(i),SVGInject(i,{afterInject:(s,t)=>{$(e).empty().append(t).removeClass(((e,s)=>(s.match(/\bstatus-icon-\S+/g)||[]).join(" "))).addClass("status-icon-"+o.cssClass)}})},_rendered:function(e,s){Panopto.SessionList.callBaseMethod(this,"_rendered",[e,s]),Panopto.Util.handleThumbnailLoad($(".thumbnail-container")),Panopto.Core.UI.Handlers.key($(".thumbnail-link"),(function(e){$(e)[0].click()}),[Panopto.Core.Key.Space,Panopto.Core.Key.Enter]),$(".list-view-row, li.item, #tableViewContainer tr").on("dragstart",(e=>{let s=this._getBatchSelection(),t=o.pluck(s,"DeliveryID");t.length&&!o.contains(t,e.currentTarget.id)&&e.preventDefault(),s.length||(s=[this._resultsDataView.findContext(e.currentTarget).dataItem],t=[s[0].DeliveryID]),this.dragManager.startDrag(c.q.SessionIdList,t);const i=e.originalEvent.dataTransfer;if(i.effectAllowed="move",i.setData("text",t.join(",")),"setDragImage"in DataTransfer.prototype){const e=o.map(s,(e=>({name:e.SessionName,thumbnail:$(`#${e.DeliveryID} .react-thumbnail-container img`)[0]})));this._dragImage=l.Q.createSessionSelectionDragImage(e),$("#resultsDiv").after(this._dragImage.element),i.setDragImage(this._dragImage.element,this._dragImage.offsetX,this._dragImage.offsetY)}})).on("dragend",(e=>{this.dragManager.endDrag(),this._removeDragImage()})),this.toggleCheckboxes(this._showCheckboxes)},_reactThumbnailLookup:{},_openMoreMenuThumbnail:void 0,_renderThumbnail:function(e,s){if(e){const t=(s.Permissions[PanoptoTS.Core.Permission.SessionDelete]||s.Permissions[PanoptoTS.Core.Permission.PlaylistDelete]||s.Permissions[PanoptoTS.Core.Permission.SessionCopySource]||s.Permissions[PanoptoTS.Core.Permission.SessionMoveSource]||s.Permissions[PanoptoTS.Core.Permission.SessionAccessControlPolicyEdit])&&Panopto.ListBase&&!s.IsArchived,o=(0,n.bootstrapReactComponent)(p.u)(e,{session:s,isSelectable:t,isMoreMenuOpen:!1,isMobile:r.Browser.$_mobile,tabIndex:-1,onMoreMenuToggle:e=>{o.setProps({isMoreMenuOpen:e}),e?this._openMoreMenuThumbnail=o:this._openMoreMenuThumbnail===o&&(this._openMoreMenuThumbnail=void 0)},onPublish:()=>{this._publish(s)},onDelete:()=>{this._batchDelete([s],this._deleteMessage)},onRestoreFromArchive:()=>{this._batchRestoreFromArchive([s])},util:Panopto.Util,resources:Panopto.GlobalResources});this._reactThumbnailLookup[s.DeliveryID]=o}},_itemRendered:function(e,s){const t=s.dataItem,o=s.get(".react-thumbnail-container");this._renderThumbnail(o,t),Panopto.SessionList.callBaseMethod(this,"_itemRendered",[e,s]);const i=this._viewMode===Panopto.Data.ViewMode.Grid?s.get(".item"):s.get("tr"),a=s.get(".folder-link"),l=s.get(".folder-link-container"),d=s.get(".session-owner-container"),c=s.get(".session-owner-link"),u=s.get(".process-state-icon"),h=s.get(".progress");let p;if(a&&t.UserCanEnumerateFolder&&($(a).addClass("non-featured-folder-link"),Panopto.Core.UI.Handlers.button($(a),(()=>Panopto.SessionList.navigateToPageState({folderID:t.FolderID})))),this.queryParams.isSubscriptionsPage&&(p=()=>this.updateData(!1,!1,null)),Panopto.features.subscriptionsEnabled&&Panopto.user.isAuthenticated&&this._viewMode===Panopto.Data.ViewMode.List){const e=$(s.get(".folder-hover-container")),o=$(a),i=(0,n.bootstrapReactComponent)(n.Subscriptions.SubscriptionHover)(e[0],{id:t.FolderID,type:AutoRestModels.SubscribableType.Folder,name:Panopto.Core.TextHelpers.innerText(t.FolderName),topOffset:e[0].getBoundingClientRect().top,initialLeftOffset:e[0].getBoundingClientRect().left,isHovered:!1,isSubscriptionsEnabled:Panopto.features.subscriptionsEnabled,onSubscriptionChange:p,subscriptionService:Panopto.Core.ServiceInterface.Rest.SubscriptionRequest,userService:Panopto.Core.ServiceInterface.Rest.Users,resources:Panopto.GlobalResources});if(o.hover((()=>{i.setProps({isHovered:!0,topOffset:e[0].getBoundingClientRect().top,initialLeftOffset:e[0].getBoundingClientRect().left})}),(()=>{i.setProps({isHovered:!1})})),t.OwnerUserId){$(d).show(),$(c).text(Panopto.Core.TextHelpers.innerText(t.OwnerFullName));const e=$(s.get(".session-owner-hover-container")),o=(0,n.bootstrapReactComponent)(n.Subscriptions.SubscriptionHover)(e[0],{id:t.OwnerUserId,type:AutoRestModels.SubscribableType.User,name:Panopto.Core.TextHelpers.innerText(t.OwnerFullName),topOffset:e[0].getBoundingClientRect().top,initialLeftOffset:e[0].getBoundingClientRect().left,isHovered:!1,isSubscriptionsEnabled:Panopto.features.subscriptionsEnabled,onSubscriptionChange:p,subscriptionService:Panopto.Core.ServiceInterface.Rest.SubscriptionRequest,userService:Panopto.Core.ServiceInterface.Rest.Users,resources:Panopto.GlobalResources});$(d).hover((()=>{o.setProps({isHovered:!0,topOffset:e[0].getBoundingClientRect().top,initialLeftOffset:e[0].getBoundingClientRect().left})}),(()=>{o.setProps({isHovered:!1})}))}}if(t.MostRecentViewPosition&&t.Duration&&$(h).width(t.MostRecentViewPosition/t.Duration*100+"%"),t.FolderID===this.queryParams.folderID&&($(s.get(".folder-separator")).addClass("redundant-folder-link"),$(l).addClass("redundant-folder-link")),!this.queryParams.folderID||Panopto.features.showThumbnailDate||this.queryParams.query&&!1!==this.queryParams.searchSubfolders||$(s.get(".details")).addClass("no-folder-row"),u){const e=t.Permissions[PanoptoTS.Core.Permission.SessionViewIsReferenceCopy]&&t.PlayableObjectType===Panopto.Core.PlayableObjectType.Reference;this._updateProcessIcon(u,t.Status,e),(t.Status!==Panopto.Data.SessionStatus.Complete||e)&&(this.showGutters=!0)}const P=$(s.get(".rating"))[0];t.AverageRating&&P&&(0,n.bootstrapReactComponent)(n.Input.RatingSelector)(P,{currentRating:t.AverageRating,readOnly:!0,size:"16px",resources:Panopto.GlobalResources});const S=t.Permissions[PanoptoTS.Core.Permission.SessionView];if(this._viewMode===Panopto.Data.ViewMode.List&&Panopto.features.tagsEnabled&&S){const e=t.Tags.map((e=>(new AutoClientModels.TagSearchItem).fromRestTagSearchItem(e))),o=$(s.get(".item-tags"));e.length&&(o.show(),Panopto.TagsContainer(o[0],{initialTags:e,canDelete:!1,canAdd:!1,searchOnClick:!0,searchInNewTab:!1,onSubscriptionChange:p,sessionId:t.DeliveryID,tagsService:Panopto.Core.ServiceInterface.Rest.TagsRequest,subscriptionService:Panopto.Core.ServiceInterface.Rest.SubscriptionRequest,userService:Panopto.Core.ServiceInterface.Rest.Users,useAbsolutePosition:!0,resources:Panopto.GlobalResources}))}const g=t.IsArchived?this._addActionButtons(i,t,{addRestoreFromArchive:!0}):this._addActionButtons(i,t,this._availableActionButtons),m=r.Browser.isTouchSupported&&g;$(s.get(".action-btn-touch-target")).toggle(m);const b=String(t.Permissions[PanoptoTS.Core.Permission.SessionMoveSource]&&!Panopto.isEmbedded);$(i).attr("draggable",b),$(i).toggleClass("draggable",b),$("a",i).attr("draggable","false"),Panopto.Core.UI.Handlers.button($(i).find(".thumbnail-link, .title-link a"),((e,s)=>this.onSessionClick(s,t)),{allowDefault:!0});const f=$find("context"+t.DeliveryID);f&&f.add_itemRendered(((e,s)=>{const o=s.dataItem,i=s.get(".search-link");Panopto.Core.UI.Handlers.button($(i),((e,s)=>this.onSessionClick(s,t,o)),{allowDefault:!0})}))},_removeDragImage:function(){this._dragImage&&(this._dragImage.element.remove(),this._dragImage=void 0)},_checkBatchButtons:function(){Panopto.SessionList.callBaseMethod(this,"_checkBatchButtons"),this._updateDraggableItemTooltips()},_publish:function(e){let s=null,t=null;e.AvailabilityWindowStart?.DateTime>new Date&&(s={publicId:e.DeliveryID,date:r.Helpers.stringifyJsonDateString(new Date),isStart:!0,requiresApproval:!1}),e.AvailabilityWindowEnd?.DateTime<new Date&&(t={publicId:e.DeliveryID,date:r.Helpers.stringifyJsonDateString(Panopto.Core.Constants.MaxSQLDate),isStart:!1,requiresApproval:!1});const o=s||t;let i=null;s&&t&&(i=t),(0,a.doFetchWcfApi)({methodName:"SetDeliveryAvailabilityWindow",data:o}).then((()=>{i?(0,a.doFetchWcfApi)({methodName:"SetDeliveryAvailabilityWindow",data:i}).then((()=>this._refresh())).catch((()=>r.Logging.Logger.warning("Failure asking the server to set availability."))):this._refresh()})).catch((()=>{r.Logging.Logger.warning("Failure asking the server to set availability.")}))},_batchRestoreFromArchive:function(e){confirm(Panopto.GlobalResources.Restore_Confirm)&&Panopto.Core.ServiceInterface.Rest.Sessions.batchRestoreFromArchive(e,$.noop,$.noop,(()=>{this.updateData(!1)}))},_updateDraggableItemTooltips:function(){const e=$(".content-table").hasClass("batch-select"),s=$("li.item, .list-view-row").filter(".draggable"),t=$("#tableViewContainer tr.draggable");s.find(".chkbox").attr("title",""),t.find("td.chkbox").attr("title",e?"":Panopto.GlobalResources.SessionList_DragToMove),e&&t.filter(".selected").find(".chkbox").attr("title",Panopto.GlobalResources.SessionList_DragToMove),$.map(s,(s=>{const t=e?s.classList.contains("selected")?Panopto.GlobalResources.SessionList_ClickToDeselect:Panopto.GlobalResources.SessionList_ClickToSelect:void 0;this._reactThumbnailLookup[s.id]?.setProps({thumbnailTooltip:t})}))},_getItemNameForPage:function(e,s){return Panopto.ModalPopup.isInSet("SessionLinks",s)?Panopto.Util.displayDeliveryName(e):Panopto.ModalPopup.isInSet("FolderLinks",s)?e.FolderName:Panopto.ModalPopup.isInSet("RemoteRecorderLinks",s)?e.RemoteRecorderName:void 0},_rendering:function(e,s){Panopto.SessionList.callBaseMethod(this,"_rendering",[e,s]),this.hasRendered=!0},_handleSearch:function(e,s){const t={};if(s.get_query())$.extend(t,{sortColumn:Panopto.Data.SessionColumns.Relevance,sortAscending:!1,isSubscriptionsPage:null,subscribableTypes:null});else if(this.queryParams.sortColumn==Panopto.Data.SessionColumns.Relevance){this.queryParams.query="";const e=this.getSortSetting();e?$.extend(t,{sortColumn:e.column,sortAscending:e.currentAscending}):$.extend(t,{sortColumn:Panopto.Data.SessionColumns.Date,sortAscending:Array.equals(this.queryParams.status,Panopto.Data.StatusSets.Scheduled)})}Panopto.SessionList.callBaseMethod(this,"_handleSearch",[e,s,t])},updateFolderData:function(e,s){const t={folderID:e};this.updatingFolderData=!0,(0,a.doFetchWcfApi)({methodName:"GetFolderInfo",data:t,loadingIndicator:document.getElementById("loadingMessage")}).then((s=>{const t=Panopto.Core.StringHelpers.parseQueryString(location.search,void 0,!0);if(s.UnauthorizedTransferUrl)window.location.href=s.UnauthorizedTransferUrl;else if(s.DepartmentHomePageUrl&&!t.noredirect){let e=s.DepartmentHomePageUrl;Panopto.embeddedModeView!==Panopto.Data.EmbeddedView.None&&(e=Panopto.Core.StringHelpers.setQueryParameters(e,{embedded:Panopto.embeddedModeView})),window.location.href=e}else this._folderDataByID[e]=s,this.queryParams.folderID==e&&(this.updatingFolderData=!1,this.setFolder(e,!0))})).catch((()=>{this.updatingFolderData=!1,this._resultsDataView.set_data([]),this._totalRows=0,this._folderDataByID[e]=null,this._subfolderList.show(!1),this._showNoResultsMessage(!0),this._displayScope(Panopto.GlobalResources.Sessions_List_ErrorLoadFolderHeader,"folder","","",!1)}))},_deleteBookmark:function(e,s){const t={bookmarkID:e,sessionID:s};(0,a.doFetchWcfApi)({methodName:this._fetchDataMethodName,data:t}).then((()=>{this.updateData()})).catch((()=>{alert(Panopto.GlobalResources.SessionList_js_FailedToDeleteBookmark)}))},_showNoResultsMessage:function(e,s,t){const o=this.queryParams.folderID,i=this.queryParams.startDate;t=t||null;let a=null;(o||i||this._isFilterApplied())&&(t=!0),this.queryParams.isSharedWithMe&&(a="sharedWithMe",t=!0),this.queryParams.bookmarked&&(a="bookmarks",t=!0),this.queryParams.isSubscriptionsPage&&(a="subscriptions",t=!0),this.isMyFolder(o)?(a="myFolder",t=!0):o&&!this._folderDataByID[o]&&(a="folder",t=!1);const r=$("#noResultsPlaceholder");this.queryParams.isSubscriptionsPage?e?this._subscriptionEmptyMessage=Panopto.SubscriptionEmptyMessage(r[0],{resources:Panopto.GlobalResources,centerOnPage:!0}):r.empty():(void 0!==this._subscriptionEmptyMessage&&(this._subscriptionEmptyMessage.unmount(),this._subscriptionEmptyMessage=void 0),Panopto.SessionList.callBaseMethod(this,"_showNoResultsMessage",[e,s,t,a]))},removeFolderSortSetting:function(e){(0,r.setUserSetting)("sortData-lastSessionGroupView-"+e,"")},updateData:function(e,s,t){t=t||{};const o=this.queryParams.folderID,i=this;this.queryParams.folderID&&t.resetFolder?($(window).on("unload",(function(){i.removeFolderSortSetting(o)})),window.location.hash="#folderID="+o,window.location.reload()):o&&t.updateFolderInfo?this.updateFolderData(o):this.updatingFolderData||Panopto.SessionList.callBaseMethod(this,"updateData",[e,s])},setFolder:function(e,s){this.queryParams.folderID=e;let t="";if(e){const s=this._folderDataByID[e];this.folderForFileDrop.id=e,this.folderForFileDrop.hasWriteAccess=s.Permissions[PanoptoTS.Core.Permission.SessionCreate];let o=s.Permissions[PanoptoTS.Core.Permission.SessionCreate]?"folder-record":"folder";this.isMyFolder(e)&&(o="my-folder");const a=Panopto.Core.TextHelpers.innerText(s.Name),r=String.format(Panopto.GlobalResources.SessionList_js_InFolder+'"{0}"',a);this._displayScope(a,o,r,this.isMyFolder(e)?i.mU_:i.mI9,!0),this._navBarInstance.highlightFolder(e),this._showCheckboxes=Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionDelete]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.PlaylistDelete]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionCopySource]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionReferenceSource]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionMoveSource]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionAccessControlPolicyEdit],this._hasBatchDeleteButton=Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionDelete]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.PlaylistDelete],this._hasBatchEditButton=this._showCheckboxes,this._headerActionButtons.updateFolderInfo(s),t=s.DepartmentHomePageUrl,t&&Panopto.embeddedModeView!==Panopto.Data.EmbeddedView.None&&(t=Panopto.Core.StringHelpers.addQueryParameter(t,{embedded:Panopto.embeddedModeView})),this._headerActionButtons.updateToggleUrlState(t),this._folderPicker&&this._folderPicker.headerReflow();const n=this._getColumnData(Panopto.Data.SessionColumns.Rating).sortSettings,l=this._getColumnData(Panopto.Data.SessionColumns.RemoteRecorder).sortSettings,d=this._getColumnData(Panopto.Data.SessionColumns.FolderName).sortSettings,c=this._getColumnData(Panopto.Data.SessionColumns.Status).sortSettings;Panopto.SessionList.showRatingColumn=Panopto.features.areRatingsEnabled,n.showInTableView=Panopto.features.areRatingsEnabled,n.showInListView=Panopto.features.areRatingsEnabled,Panopto.SessionList.showFolderNameColumn=!1,d.showInTableView=!1,d.showInListView=!1,this._specificSortSettingName="lastSessionGroupView-"+s.ID,s.DeliveriesHaveSpecifiedOrder?this._toggleOrderVisibility(!0):this._toggleOrderVisibility(!1),this.setPreviousSort(),Panopto.SessionList.showRemoteRecorderColumn=!1,l.showInTableView=!1,l.showInListView=!1,Panopto.SessionList.showStatusColumn=!1,c.showInTableView=!1,c.showInListView=!1,this._updateBranding(s.BrandAccentColor,s.BrandWebLogoUrl)}else this.folderForFileDrop.id="",this.folderForFileDrop.hasWriteAccess=!1,this._hasBatchDeleteButton=Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionDelete]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.PlaylistDelete],this._hasBatchEditButton=!0,this._showCheckboxes=Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionDelete]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.PlaylistDelete]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionCopySource]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionReferenceSource]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionMoveSource]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionAccessControlPolicyEdit],this._displayDesignerQuery(),this._specificSortSettingName=null,this._toggleOrderVisibility(!1),this.setPreviousSort(),this._headerActionButtons&&this._headerActionButtons.hideFolderActions(),this._sessionFiltersProps={...this._sessionFiltersProps,searchSubfoldersToggleShown:!1},this._actionHeader.setProps({sessionFiltersProps:this._sessionFiltersProps}),this._updateBranding(this._siteBrandAccentColor,this._siteBrandWebLogoUrl);const o=this._folderDataByID[e]||null;this._headerComponent?.setProps({folderData:o,departmentViewToggleUrl:t,showParentFolderButton:!!this.queryParams.folderID,showArchiveButton:!1,isParentFolderButtonEnabled:!1});const a=e&&(o.Permissions[PanoptoTS.Core.Permission.SessionCreateScheduledRecording]||o.Permissions[PanoptoTS.Core.Permission.SessionCreateScheduledRecordingRestrictedBySetting]);this._sessionFiltersProps={...this._sessionFiltersProps,scheduledToggleShown:a},this._actionHeader.setProps({sessionFiltersProps:this._sessionFiltersProps}),s&&this.updateData(),this._sortHeaderStale=!0},_updateBranding:function(e,s){e&&e!==Panopto.branding.accentColor&&(Panopto.Branding.renderBrandingColors(e),Panopto.Branding.brandElements(e),Panopto.branding.accentColor=e,(0,r.setPrimaryColor)(e),n.Material.setBrandColor("#"+e),this._createMenu?.setProps({theme:n.Material.panoptoTheme})),s&&s!==Panopto.branding.largeLogo.png&&(Panopto.Branding.createLogo($("#logoContainer.large-logo"),{png:s,svgWidth:Panopto.branding.largeLogo.svgWidth,svgHeight:Panopto.branding.largeLogo.svgHeight},!0),Panopto.branding.largeLogo.png=s)},_toggleOrderVisibility:function(e){const s=this._getColumnData(Panopto.Data.SessionColumns.Order).sortSettings;this._specificSortDefault=e?{sortColumn:Panopto.Data.SessionColumns.Order,sortAscending:!0}:null,s.showInListView=e},setStatus:function(e){if(this.queryParams.status=e,this.queryParams.folderID){const e=$.grep(this.queryParams.status||[],(function(e){return e==Panopto.Data.SessionStatus.Scheduled})).length>0;this._sessionFiltersProps={...this._sessionFiltersProps,includeScheduledSessions:e},this._actionHeader.setProps({sessionFiltersProps:this._sessionFiltersProps})}else this._displayDesignerQuery()},getSortSetting:function(){return this.queryParams.isSubscriptionsPage?void 0:Panopto.SessionList.callBaseMethod(this,"getSortSetting")},setPreviousSort:function(){const e=this.getSortSetting();if(e){if(this._columnData[e.column]){const s=e.column,t=e.currentAscending;s===this.queryParams.sortColumn&&t===this.queryParams.sortAscending||this._setSort(s,t,!0)}}else this._specificSortDefault?this._setSort(this._specificSortDefault.sortColumn,this._specificSortDefault.sortAscending):this._setSort(Panopto.Data.SessionColumns.Date,!1,!0)},setSearchSubfolders:function(e){this.queryParams.searchSubfolders=e,this._sessionFiltersProps={...this._sessionFiltersProps,searchSubfolders:!1!==e},this._actionHeader.setProps({sessionFiltersProps:this._sessionFiltersProps})},setIncludeArchived:function(e){this.queryParams.includeArchived=e,this._sessionFiltersProps={...this._sessionFiltersProps,searchArchivedSessions:e},this._actionHeader.setProps({sessionFiltersProps:this._sessionFiltersProps})},_displayScope:function(e,s,t,o="",i){const a=Panopto.embeddedModeView!==Panopto.Data.EmbeddedView.Mini?String.format(Panopto.GlobalResources.SessionList_js_Search,t):Panopto.GlobalResources.SessionList_js_MiniSearch;Panopto.Application.defaultInstance.setSearchWatermarkText(a);const n=$("#folderPicker"),l=$("#contentHeader"),d=this,c=d.queryParams.folderID,u=d.queryParams.query;if(Panopto.isEmbedded){S.I.isFromTeams?($("#content").addClass("teamsApp-content"),Panopto.embeddedModeView!=Panopto.Data.EmbeddedView.Mini&&l.hide()):l.hide();const s=r.Helpers.StringHelpers.getUserKeyComponents(Panopto.user.userKey).provider;s&&Panopto.GoogleAnalytics.sendEvent({source:"session-list",action:"embedded-view",label:s}),Panopto.embeddedModeView!==Panopto.Data.EmbeddedView.Mini&&(this._folderPicker||Panopto.Core.StringHelpers.parseQueryString(location.hash.slice(1)).folderID&&!c?c&&this._folderPicker.getFolder()!==c&&this._folderPicker.setFolder(c):(n.toggle(!u),this._folderPicker=Panopto.Core.UI.Components.folderPicker(n,Panopto.UI.SharedResources.commonFolderPickerStrings,{includeSandboxes:!0,includeMySandbox:!0,selectedFolderId:c,selectedFolderName:e,allowNoSelection:!0,noSelectionClass:Panopto.SessionList.Constants.FolderPickerNoSelectionClass,pickerStyle:Panopto.Core.UI.Components.FolderPickerStyles.Header,onChange:function(e){e&&e.id!==d.queryParams.folderID&&Panopto.SessionList.navigateToPageState({folderID:e.id})}})))}this._updateCreateMenuFolder(),i&&!this.isMyFolder(this.queryParams.folderID)||this._navBarInstance.highlightItem("."+s),this._headerComponent?.setProps({title:e,headerIcon:o}),this.folderForFileDrop.name=e;const h="scheduled"===s?"scheduled":"sessions";Panopto.Application.SetClassName("content-"+h),$("#searchContextHeaderText").text(e),document.title=String.format(Panopto.GlobalResources.Session_List_Title_With_Context,e)},_updateCreateMenuFolder:function(){const e=this.queryParams.folderID||void 0,s=e?this._folderDataByID[e]?.Name:void 0;this._createMenu?.setProps({folderId:e,folderName:s})},_displayDesignerQuery:function(){const e=this._getColumnData(Panopto.Data.SessionColumns.Rating).sortSettings,s=this._getColumnData(Panopto.Data.SessionColumns.RemoteRecorder).sortSettings,t=this._getColumnData(Panopto.Data.SessionColumns.FolderName).sortSettings,o=this.isMyFolder(this.queryParams.folderID),a=this.queryParams.isSharedWithMe,r=Array.equals(this.queryParams.status,Panopto.Data.StatusSets.InProgress),n=Array.equals(this.queryParams.status,Panopto.Data.StatusSets.Scheduled),l=this.queryParams.bookmarked,d=this.queryParams.isSubscriptionsPage,c=!(o||a||r||n||l||d),u=Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionCreateScheduledRecordingRestrictedBySetting];this._headerComponent?.setProps({isSubscriptionsPage:d,showStatLink:c&&(Panopto.features.viewerStatsEnabled||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionViewAnalytics])&&!Panopto.features.disableFeaturesRequiringExternalNetworkAccess});const h=this.queryParams.isSharedWithMe&&this.config.showSharedWithMeDateSort&&(!this.queryParams.query||this.config.showSharedWithMeSearchSort),p=this._getColumnData(Panopto.Data.SessionColumns.SharedWithMeDate).sortSettings;Panopto.SessionList.showSharedWithMeColumn=h,p.showInTableView=h,p.showInListView=h,Panopto.SessionList.showFolderNameColumn=!0,t.showInTableView=!0,t.showInListView=!0;const P=n&&u;Panopto.SessionList.showRemoteRecorderColumn=P,s.showInTableView=P,s.showInListView=P;const S=Panopto.features.areRatingsEnabled&&(c||l||d);Panopto.SessionList.showRatingColumn=S,e.showInTableView=S,e.showInListView=S;let g=null;for(const e of this._columnData)e.column===this.queryParams.sortColumn&&(g=e);g.column!==Panopto.Data.SessionColumns.Relevance&&(g.sortSettings.showInTableView?this.setPreviousSort():Panopto.SessionList.callBaseMethod(this,"setDefaultSort")),this._sortHeaderStale=!0;const m=c?[Panopto.GlobalResources.Everything,"everything",Panopto.GlobalResources.Everything,i.gzz]:o?[Panopto.GlobalResources.MyFolder,"my-folder",Panopto.GlobalResources.MyFolder,i.mU_]:a?[Panopto.GlobalResources.SharedWithMe,"shared-with-me",Panopto.GlobalResources.SharedWithMe,i.i8q]:r?[Panopto.GlobalResources.SessionList_js_InProgress,"in-progress",Panopto.GlobalResources.SessionList_js_SessionsInProgress,i.ag0]:n?[Panopto.GlobalResources.SessionList_js_Scheduled,"scheduled",Panopto.GlobalResources.SessionList_js_ScheduledSessions,i.OMw]:l?[Panopto.GlobalResources.SessionList_js_Bookmarked,"bookmarked",Panopto.GlobalResources.SessionList_js_BookmarkedSessions,i.w7y]:d?[Panopto.GlobalResources.SessionList_js_Subscriptions,"subscriptions",Panopto.GlobalResources.Everything,i.Qbq]:[];this._displayScope(...m)},_isFilterApplied:function(){return this.queryParams.status||Panopto.SessionList.callBaseMethod(this,"_isFilterApplied")},_batchShare:function(e){if(1===e.length){const s=e[0].PlayableObjectType===Panopto.Core.PlayableObjectType.Playlist;Panopto.Application.defaultInstance.updateState({modalPage:s?"PlaylistShare":"SessionShare",modalHeader:Panopto.Util.displayDeliveryNameWithoutHighlighting(e[0]),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({isFolder:!1,isPlaylist:s,id:e[0].DeliveryID})})}else Panopto.ModalPopup.defaultInstance.modalArguments({batchIdsAndTypes:o.map(e,(function(e){return{id:e.DeliveryID,type:e.PlayableObjectType}})),isFolder:!1}),Panopto.SessionList.callBaseMethod(this,"_batchShare",[e])},getCurrentFolderProperties:function(){const e=this.queryParams.folderID,s=this._folderDataByID[e],t=s?.Name,o=s?.Permissions;return{id:e,name:t,permissions:o}},isMyFolder:function(e){return!!e&&e===Panopto.user.sandboxFolderId},updateArchiveOptions:function(e,s,t,o){const i=PanoptoTS.Core.Permission,a=Boolean(s&&!o&&Panopto.features.enableRetentionArchiveFeature&&Panopto.user.isAuthenticated&&(Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionEnumerateArchived]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionSearchArchivedViewableOnly]||Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionSearchArchivedViewableOnlyInFolderOnly]));a&&s===e||(this._sessionFiltersProps={...this._sessionFiltersProps,archivedToggleShown:!1,showArchivedSessions:!1},this._actionHeader.setProps({sessionFiltersProps:this._sessionFiltersProps}),this.archivedFooter.setProps({isVisible:!1}),this.queryParams.sessionListOnlyArchived=!1),this.queryParams.includeArchivedStateCount=a&&(s!==e||o!==t)&&!this.queryParams.sessionListOnlyArchived;const r=Panopto.user.somewherePermissions[i.SessionSearchArchivedViewableOnly]||s&&Panopto.user.somewherePermissions[i.SessionSearchArchivedViewableOnlyInFolderOnly],n=Boolean(o&&r&&!Array.equals(this.queryParams.status,Panopto.Data.StatusSets.InProgress)&&!Array.equals(this.queryParams.status,Panopto.Data.StatusSets.Scheduled)&&Panopto.features.enableRetentionArchiveFeature);this._sessionFiltersProps.searchArchivedToggleShown!==n&&(this._sessionFiltersProps={...this._sessionFiltersProps,searchArchivedToggleShown:n},this._actionHeader.setProps({sessionFiltersProps:this._sessionFiltersProps}))}},Panopto.SessionList.displayRemoteRecorder=function(e){return e==Panopto.Data.SessionStatus.Scheduled||e==Panopto.Data.SessionStatus.InProgress||e==Panopto.Data.SessionStatus.Live},Panopto.SessionList.navigateToPageState=function(e){Panopto.Application.defaultInstance.updateState({status:null,query:null,folderID:null,bookmarked:null,page:null,startDate:null,endDate:null,sortColumn:null,sortAscending:null,searchSubfolders:null,isSharedWithMe:null,isSubscriptionsPage:null,subscribableTypes:null,...e})},Panopto.SessionList.updateFolderInHash=function(e){const s=Panopto.Core.StringHelpers.parseQueryString(window.location.hash.substring(1));return s.folderID=e,"#"+Panopto.Core.StringHelpers.serializeObjectToQueryString(s)},Panopto.SessionList.registerClass("Panopto.SessionList",Panopto.ListBase)},53140:(e,s,t)=>{t.d(s,{g:()=>c});var o=t(45147),i=t(6376),a=t(20628),r=t(18592),n=t.n(r),l=t(64952);class d extends i.Component{render(){const e=l.Material.withStyles.getClasses(this.props);return this.props.isVisible&&this.props.archivedCount?(0,o.YH)("div",{className:e.root,children:[(0,o.im)(n(),{path:a.u_E,className:e.icon,size:l.Material.headerFontSize,"aria-hidden":"true"}),(0,o.im)("span",{children:this.props.resources.SessionList_Archived_FooterMessage.format(this.props.archivedCount)}),(0,o.im)("span",{className:e.link,onClick:this.props.onClickShowArchived,children:this.props.resources.SessionList_Archived_FooterMessage_ShowArchived})]}):(0,o.im)(o.ae,{})}}const c=l.Material.withStyles(d,((e,s)=>({root:{display:"inline-flex",width:"100%",marginTop:19,marginBottom:36,borderRadius:6,backgroundColor:s.isBackgroundShaded?"#f5f5f5":"#fff",alignItems:"center",fontSize:14,color:l.Material.colorBlack46},icon:{margin:"18px 14px 18px 26px"},link:{marginLeft:"12px",color:l.Material.colorBlue,cursor:"pointer"}})))},52576:(e,s,t)=>{t.d(s,{w:()=>i});var o=t(73568);class i{constructor(e,s,t,i){this.isDragHovered=!1,e.on("dragover dragenter dragleave drop",(a=>{const r=a.originalEvent.dataTransfer;if(!r?.types.some((e=>"Files"===e)))return;const n=i();switch(n||(r.dropEffect="none"),a.preventDefault(),a.stopPropagation(),a.type){case"dragenter":case"dragleave":{let s=Number(e.data("dragHoverCount"))||0;"dragenter"===a.type?s++:s--,e.data("dragHoverCount",s);const o=s>0;o!==this.isDragHovered&&(this.isDragHovered=o,t({isHovered:o}));break}case"drop":if(t({isHovered:!1}),e.data("dragHoverCount",0),this.isDragHovered=!1,n){const e=this.getFileSystemEntries(a);this.handleFileDrop(e,s),o.InternalAnalytics.trackPendoEvent({name:"Video(s) created: Session list > drag and drop",metadata:{numVideos:e.length}})}}}))}handleFileDrop(e,s){const t=new CustomEvent("filesDropped",{detail:{fileSystemEntries:e,folderId:s.id,folderName:s.name}});window.dispatchEvent(t)}getFileSystemEntries(e){const s=e.originalEvent,t=s.dataTransfer?.items??[],o=[];if(!t.length)return o;const i=t[0].webkitGetAsEntry?"webkitGetAsEntry":t[0].getAsEntry?"getAsEntry":void 0;if(!i)return o;for(let e=0;e<t.length;e++)if("file"===t[e].kind){const s=t[e][i]();s&&o.push(s)}return o}}},9534:e=>{e.exports=PanoptoApiClient},73568:e=>{e.exports=PanoptoCore},64952:e=>{e.exports=PanoptoReactComponents},6376:e=>{e.exports=React},72844:e=>{e.exports=_}},t={};function o(e){var i=t[e];if(void 0!==i)return i.exports;var a=t[e]={id:e,exports:{}};return s[e](a,a.exports,o),a.exports}o.m=s,e=[],o.O=(s,t,i,a)=>{if(!t){var r=1/0;for(c=0;c<e.length;c++){for(var[t,i,a]=e[c],n=!0,l=0;l<t.length;l++)(!1&a||r>=a)&&Object.keys(o.O).every((e=>o.O[e](t[l])))?t.splice(l--,1):(n=!1,a<r&&(r=a));if(n){e.splice(c--,1);var d=i();void 0!==d&&(s=d)}}return s}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[t,i,a]},o.n=e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return o.d(s,{a:s}),s},o.d=(e,s)=>{for(var t in s)o.o(s,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:s[t]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),o.j=8192,(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var s=o.g.document;if(!e&&s&&(s.currentScript&&(e=s.currentScript.src),!e)){var t=s.getElementsByTagName("script");if(t.length)for(var i=t.length-1;i>-1&&!e;)e=t[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{o.b=document.baseURI||self.location.href;var e={8192:0};o.O.j=s=>0===e[s];var s=(s,t)=>{var i,a,[r,n,l]=t,d=0;if(r.some((s=>0!==e[s]))){for(i in n)o.o(n,i)&&(o.m[i]=n[i]);if(l)var c=l(o)}for(s&&s(t);d<r.length;d++)a=r[d],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(c)},t=this.webpackChunk_panopto_webpack=this.webpackChunk_panopto_webpack||[];t.forEach(s.bind(null,0)),t.push=s.bind(null,t.push.bind(t))})(),o.nc=void 0;var i=o.O(void 0,[264],(()=>o(91512)));i=o.O(i)})();
//# sourceMappingURL=file://engfs.d.panopto.com/share/jenkinsbuilds/rel_rtc_14.13.0/14.13.0.00021/_PublishedWebsites/WebUI/Scripts/Panopto/Bundles/SessionList.js.map