"use strict";Type.registerNamespace("Panopto"),Panopto.ListBase=function(e){this._fetchDataMethodName=e,Sys.converters.displayDate=Panopto.Util.displayDate,Sys.converters.displayTime=Panopto.Util.displayTime,Sys.converters.displayTaskMessage=Panopto.ListBase.displayShortTaskStateMessage,Sys.converters.displayDuration=Panopto.Util.displayDuration,Sys.converters.displayPrice=Panopto.Util.displayDollars,Sys.converters.displayTotalCost=Panopto.Util.displayDollars,Sys.converters.displayEmail=Panopto.Util.displayEmail,Sys.converters.displayRole=Panopto.Data.AclRoleType.getDisplayName},Panopto.ListBase.c_defaultMaxResults=25,Panopto.ListBase.cNoThumbnailImageUrl=Panopto.cacheRoot+"/Images/no_thumbnail.svg",Panopto.ListBase.hoveredItem=null,Panopto.ListBase.currentQuery=null,Panopto.ListBase.prototype={_isStale:!0,_lastListRequest:null,_resultsDataContext:null,_saveOperation:null,_deleteMessage:null,_fetchDataMethodName:null,_viewMode:null,_defaultView:null,_defaultSortColumn:null,_defaultSortAscending:null,_sortHeaderDataView:null,_sortHeaderStale:!1,_sortDropDownProps:null,_batchSelectionProps:{},_dateFilterProps:null,_viewToggleProps:null,_resultsDataView:null,_pagingFooterComponent:null,_totalRows:0,_searchWatermark:null,_enableBatchDelete:!1,_enableBatchCopy:!1,_enableBatchMove:!1,_viewSetting:null,_pageSizes:[10,25,50,150,250],_supportsSearch:!0,_gridViewEnabled:!1,_batchRestore:null,_batchRemovePermanently:null,_batchRestoreFromArchive:null,queryParams:{query:null,sortColumn:null,sortAscending:null,maxResults:Panopto.ListBase.c_defaultMaxResults,page:0,startDate:null,endDate:null},init:function(e){var t=this;this._supportsSearch&&Panopto.Application.defaultInstance.add_searchSubmit(_.throttle(((e,t,s)=>this._handleSearch(e,t,s)),Panopto.Core.Constants.SEARCH_QUERY_THROTTLE_MS)),Panopto.Application.defaultInstance.setSearchWatermarkText(this._searchWatermark),$("body").css("overflow-y","hidden"),this._handleResize(),$(window).resize((function(){t._handleResize(),t._matchHeaderAndContentTableWidths()})),Panopto.Core.UI.Handlers.button($("#refreshButton"),(()=>{this.updateData(!1)}),{allowPropagation:!0}),Panopto.Core.UI.Handlers.button($("#batchDeleteButton"),(()=>{this._enableBatchDelete&&this._batchDelete(this._getBatchSelection())}),{allowPropagation:!0}),$(".content-header input[type='checkbox']").bind("keydown",this.bindInputKeys),$("#sortHeaderDataView input[type='checkbox']").bind("keydown",this.bindInputKeys),PanoptoCore.Browser.isMac&&$(".list-actions").addClass("mac-additional-width"),Panopto.ModalPopup.defaultInstance.opener=this;let s=(e,t,s=!1)=>{var o=$(e).parent().find(".selectall"),a=o.is(":checked");s&&(a=!a,o.prop("checked",a)),this._selectAll(a)};Panopto.Core.UI.Handlers.button($(".selectall"),s,{allowDefault:!0}),Panopto.Core.UI.Handlers.button($(".select-all-cell"),((e,t)=>s(e,0,!0)),{allowPropagation:!0}),$("#listHeader .selectall").on("focus blur",(e=>{$("#sortHeaderDataView").toggleClass("checkbox-focused","focus"===e.type)})),e&&(Panopto.dateRangePicker=new Panopto.DateRangePicker),this._sortHeaderDataView=Sys.create.dataView("#sortHeaderDataView",{itemTemplate:$get("columnHeaderTemplate"),itemPlaceholder:$get("columnHeaderPlaceholder"),itemRendered:(e,t)=>{var s=t.dataItem,o=t.get("th"),a=t.get(".sort-field");if(t.get(".list-view-header").id="listViewHeader-"+s.column,this._viewMode==Panopto.Data.ViewMode.Table)if(s.sortSettings.showInTableView){if($(o).show(),$(o).addClass(s.cssClass||"list-default"),!s.sortSettings.sortable&&!s.sortSettings.filterable)return void $(a).addClass("disabled").attr("tabindex","-1")}else $(o).hide();if(this._viewMode!=Panopto.Data.ViewMode.List&&this._viewMode!=Panopto.Data.ViewMode.Grid||(s.sortSettings.sortable||s.sortSettings.filterable)&&s.sortSettings.showInListView){if(s.sortSettings.filterable){const e=t.get(".filterIcon");$(e).css("display","inline-block")}Panopto.Core.UI.Handlers.button($(a),(()=>{this._sortDisabled?$.noop():s.sortSettings.filterable?$(a).parent().find(".filter-icon").click():this._handleSort(s.column)}),{allowPropagation:!0})}else{var i=t.get(".item");$(i).hide()}},rendered:(e,t)=>{this._indicateSort(),this._sortHeaderStale=!1}}),this._resultsDataView=Sys.create.dataView("#resultsDiv",{rendering:(e,t)=>this._rendering(e,t),itemRendered:(e,t)=>this._itemRendered(e,t),rendered:(e,t)=>this._rendered(e,t),command:(e,t)=>this._itemCommand(e,t)});let o=Panopto.Data.ViewMode.List;this._forceGridView=Panopto.isEmbedded&&$(window).width()<=500,this._forceGridView&&(o=Panopto.Data.ViewMode.Grid),this._defaultView="number"==typeof this._defaultView?this._defaultView:o,this.setView(this._defaultView,!1),this._initializeColumnSortData(),this._sortDropDownProps={sortOptions:this._getSortOptions(),selectedOptionId:this.queryParams.sortColumn,sortDirection:this.queryParams.sortAscending?"ascending":"descending",onSelectedOptionChange:e=>{e!==this.queryParams.sortColumn&&this._handleSort(e)},onSortDirectionChange:e=>{"ascending"===e!==this.queryParams.sortAscending&&this._handleSort(this.queryParams.sortColumn)}};const a=e=>{this._batchSelectionProps={...this._batchSelectionProps,selectAll:e},this._actionHeader.setProps({batchSelectionProps:this._batchSelectionProps}),this._selectAll(e)};this._batchSelectionProps={...this._batchSelectionProps,selectAll:!1,selectionCount:0,onSelectAllChanged:a,onShare:()=>{this._batchShare(this._getBatchSelection())},onCopy:()=>{this._batchEdit(Panopto.features.sessionReferenceCopiesEnabled?"reference":"copy",this._getBatchSelection())},onMove:()=>{this._batchEdit("move",this._getBatchSelection())},onDelete:()=>{this._batchDelete(this._getBatchSelection())},onCancel:()=>{this._actionHeader.setProps({showBatchSelection:!1}),a(!1)}},this._viewToggleProps={gridViewEnabled:!0,selectedView:this._viewMode,onSelectView:e=>{Panopto.Application.defaultInstance.updateState({view:e}),this.setViewSetting(e),this._matchHeaderAndContentTableWidths()}},this._dateFilterProps={dateRange:[null,null],onDateRangeChange:(e,t)=>{e=e??t,t=t??e,Panopto.Application.defaultInstance.updateState({startDate:e?.format("MM/DD/YYYY")??null,endDate:t?.format("MM/DD/YYYY")??null,page:null})}};const i=PanoptoCore.Browser.isMobileOrTablet||Panopto.isIOS;this._actionHeader=Panopto.ActionHeader($("#actionHeader")[0],{showSort:!1,sortDropDownProps:this._sortDropDownProps,showBatchSelection:!1,batchSelectionProps:this._batchSelectionProps,showDateFilter:!1,dateFilterProps:this._dateFilterProps,showViewToggle:!1,viewToggleProps:this._viewToggleProps,showPreviewButton:!1,useCompactMode:i,resources:Panopto.GlobalResources}),this._pagingFooterComponent=PanoptoReactComponents.bootstrapReactComponent(PanoptoReactComponents.Navigation.PaginationFooter)($("#pager")[0],{count:this._totalRows,page:this.queryParams.page,rowsPerPage:this.queryParams.maxResults,rowsPerPageOptions:this._pageSizes,onPageChange:e=>{Panopto.Application.defaultInstance.updateState({page:e})},onRowsPerPageChange:e=>{Panopto.Application.defaultInstance.updateState({page:0,maxResults:e})},useCompactMode:i,resources:Panopto.GlobalResources})},_rendering:function(e,t){Sys.Observer.makeObservable(e.get_data())},_handleResize:function(){const e=_.first(this._pageSizes),t=Panopto.isEmbedded&&this._totalRows<e;Panopto.Util.handleResize(!0,t)},_selectAll:function(e){$(".content-table tr, .content-table .item").has("input:checkbox").toggleClass("selected",e),$(".content-table input:checkbox").prop("checked",e).each(((t,s)=>{this._resultsDataView.findContext(s).dataItem.selected=e})),this._checkBatchButtons()},bindInputKeys:function(e){e.keyCode===Panopto.Core.Key.Enter&&$(this).click(),e.stopPropagation()},_itemRendered:function(e,t){let s=t.dataItem,o=this._viewMode===Panopto.Data.ViewMode.Grid?".item":"tr",a=$(t.get(o)),i=$("input:checkbox",a);Panopto.Core.UI.Handlers.button(a,((e,t)=>{const o=[".react-thumbnail-container",".transcription-request-more-info",".transcription-request-error-status",".folder-hover-container",".tag-hover-container"].join(", "),n=$(t.target).closest(o).length>0,r=$(t.target).closest(".chkbox").length>0,l=$(t.target).closest(".thumbnail-not-link").length>0;i.length>0&&(!n||r||l)&&(s.selected=!s.selected,i.prop("checked",s.selected),a.toggleClass("selected",s.selected),this._checkBatchButtons())}),{allowDefault:!0,allowPropagation:!0}),s.selected&&(i.prop("checked",s.selected),a.addClass("selected"))},_itemCommand:function(e,t){var s=t.get_commandSource(),o=e.findContext(s),a=o.dataItem,i=t.get_commandName();if("delete"===i)this._onItemDeleting&&this._onItemDeleting(a),confirm(this._deleteMessage)&&(this._resultsDataContext.removeEntity(a),o.data.remove(a),this._deleteCall?this._deleteCall([a]):this._resultsDataContextSaveWithReporting([a])),t.set_cancel(!0);else if(i.match(/showModal:/i)){var n=i.substring(i.indexOf(":")+1,i.length),r=t.get_commandArgument(),l=Panopto.Core.TextHelpers.innerText(this._getItemNameForPage(a,n)),c=Panopto.Core.StringHelpers.serializeObjectToQueryString(r);"Stats"===n&&(l=null),Panopto.Application.defaultInstance.updateState({modalPage:n,modalHeader:l,modalParams:c}),t.set_cancel(!0)}},toggleCheckboxes:function(e){$("#content").toggleClass("no-checkboxes",!e)},_rendered:function(e,t){var s=function(e){if(e!==Panopto.ListBase.hoveredItem){Panopto.ListBase.hoveredItem&&o(Panopto.ListBase.hoveredItem),Panopto.ListBase.hoveredItem=e,$(e).addClass("hovered");var t,s=$(".action-btns",e);s.find(".action-icon").length>0&&($(".list-name .secondary-name",e).hide(),$(".hide-on-hover",e).hide(),s.show(),t=s[0].scrollHeight>s.height()+1,$(".session-action-list",e).toggleClass("icon-only",t)),$(e).data("hovered",!0)}},o=function(e){$(e).data("hovered")&&(Panopto.ListBase.hoveredItem=null,$(e).data("hovered",!1),$(e).removeClass("hovered"),$(".action-btns .action-icon",e).length>0&&($(".list-name .secondary-name",e).show(),$(".hide-on-hover",e).show(),$(".action-btns",e).hide(),$(".item-contents .status-message",e).show(),$(".session-action-list",e).toggleClass("icon-only",!1)))};let a=this._viewMode===Panopto.Data.ViewMode.Grid?".item":"tr";$(".content-table "+a).hover((function(e){s(e.currentTarget)}),(function(e){o(e.currentTarget)})).focusin((e=>s(e.currentTarget)));let i=$(".content-table .action-btn-touch-target");Panopto.Core.UI.Handlers.button(i,(function(e){let t=$(e).siblings(".action-btns");$(".action-label",t);if("none"===t.css("display")){$(".content-table .action-btns").hide(),t.css("visibility","hidden").show(),t.toggleClass("icon-only",!1);let e=t.prop("scrollHeight")>t.height();t.toggleClass("icon-only",e),t.css("visibility","").hide()}t.toggle({effect:"slide",direction:"left",easing:"easeOutCubic",duration:200,queue:!1}),t.closest(a).find(".chkbox").addClass("active")})),i.mousedown((function(e){e.preventDefault()})),$(".content-table {0} a".format(a)).click((function(e){e.stopPropagation()})),Panopto.Core.UI.Handlers.button($("#resultsDiv .thumbnail-span"),$.noop,{allowPropagation:!0}),Panopto.Core.UI.Handlers.button($("#resultsDiv .chkbox input[type='checkbox']"),$.noop,{allowDefault:!0,allowPropagation:!0}),$("#resultsDiv input[type='checkbox']").bind("keydown",this.bindInputKeys),this._checkBatchButtons(),this._handleResize()},_getBatchSelection:function(){var e=this,t=[];return $(".chkbox input:checkbox").each(((s,o)=>{if(o.checked){var a=e._resultsDataView.findContext(o).dataItem;t.push(a)}})),t},setViewSetting:function(e){this._viewSetting&&Panopto.user.userKey&&PanoptoCore.setUserSetting(this._viewSetting,e)},_sortSettingName:function(){return this.queryParams.query?this._searchSortSettingName:this._specificSortSettingName?this._specificSortSettingName:this._defaultSortSettingName},setSortSetting:function(e){var t={column:null,currentAscending:null};Panopto.user.userKey.length&&this._sortSettingName()&&(t.column=e.column,t.currentAscending=e.sortSettings.currentAscending,PanoptoCore.setUserSetting("sortData-"+this._sortSettingName(),JSON.stringify(t)))},isColumnSortable:function(e){var t=this._getColumnData(e).sortSettings||{};return!!t.sortable&&((this._viewMode!==Panopto.Data.ViewMode.List&&this._viewMode!==Panopto.Data.ViewMode.Grid||!1!==t.showInListView)&&(this._viewMode!==Panopto.Data.ViewMode.Table||!1!==t.showInTableView))},getSortSetting:function(){var e=null;if(Panopto.user.userKey.length&&this._sortSettingName()){let t=PanoptoCore.getUserSetting("sortData-"+this._sortSettingName());if(t&&(e=JSON.parse(t),!this.isColumnSortable(e.column)))return null}return e},getViewSetting:function(){var e=null;if(this._viewSetting&&Panopto.user.userKey.length){const t=PanoptoCore.getUserSetting(this._viewSetting);"number"==typeof t&&(e=t)}return e},_getItemNameForPage:function(e,t){},_handleNavigate:function(e,t){let s=t.get_state(),o=this.getViewSetting();null!==o&&Panopto.user.isAuthenticated&&!Panopto.isEmbedded||(o=this._defaultView);var a=void 0===s.view?o:s.view;a!=this._viewMode&&this.setView(a,!0);var i=s.page||0;i!=this.queryParams.page&&(this.setPage(i),this._isStale=!0),s.query!=this.queryParams.query&&(this._setQuery(s.query),this._isStale=!0);var n=this.getSortSetting();!n&&s.query&&this._defaultSearchColumn?n={column:this._defaultSearchColumn,currentAscending:this._defaultSortAscending}:n||(n={column:this._getDefaultSort(s),currentAscending:this._defaultSortAscending});var r="true"===s.sortAscending||!0===s.sortAscending,l=void 0===s.sortColumn||null===s.sortColumn?n.column:s.sortColumn,c=void 0===s.sortAscending||null===s.sortAscending?n.currentAscending:r;l==this.queryParams.sortColumn&&c==this.queryParams.sortAscending||(this._setSort(l,c),this._isStale=!0),s.startDate==this.queryParams.startDate&&s.endDate==this.queryParams.endDate||(this.setDates(s.startDate,s.endDate),this._isStale=!0);var h=s.maxResults||Panopto.ListBase.c_defaultMaxResults;(h=-1==h?null:h)!=this.queryParams.maxResults&&(this.setResultsSize(h),this._isStale=!0)},_handleSearch:function(e,t,s){var o=$.extend({query:t.get_query(),page:null},s);Panopto.Application.defaultInstance.updateState(o)},_displaySearch:function(e){var t=this._getColumnData(Panopto.Data.SessionColumns.Relevance);t.sortSettings.showInListView=!!e,t.sortSettings.showInTableView=!!e,this._sortHeaderStale=!0},setDefaultView:function(e){this._defaultView=e},setView:function(e){this._viewMode=e;var t=e==Panopto.Data.ViewMode.Table,s=e==Panopto.Data.ViewMode.List,o=e==Panopto.Data.ViewMode.Grid;$("#tableHeader").toggle(t),this._sortHeaderDataView.refresh(),this._viewToggleProps={...this._viewToggleProps,selectedView:e},this._sortDropDownProps={...this._sortDropDownProps,sortOptions:this._getSortOptions()},this._actionHeader?.setProps({showSort:!this.queryParams.isSubscriptionsPage,sortDropDownProps:this._sortDropDownProps,viewToggleProps:this._viewToggleProps}),$("#tableViewContainer").toggle(t),$("#listViewContainer").toggle(s),$("#gridViewContainer").toggle(o),this._resultsDataView.set_itemPlaceholder(t?$get("tableViewItemPlaceholder"):s?$get("listViewItemPlaceholder"):$get("gridViewItemPlaceholder")),this._resultsDataView.set_itemTemplate(t?$get("tableViewItemTemplate"):s?$get("listViewItemTemplate"):$get("gridViewItemTemplate"))},_setQuery:function(e){var t=!!e;this._supportsSearch&&(this.queryParams.query=e?e.trim():e,Panopto.ListBase.currentQuery=e,Panopto.Application.defaultInstance.setSearchText(e||""),$("#cancelSearch").toggle(t),$("#searchHeader").toggle(t&&Panopto.embeddedModeView!==Panopto.Data.EmbeddedView.Mini),$("#searchHeaderText").text(e||""),this._headerComponent?.setProps({searchText:e}),!(Panopto.teamsApp?.isFromTeams&&Panopto.embeddedModeView==Panopto.Data.EmbeddedView.Mini)&&$("#contentHeader").toggle(!t&&!Panopto.isEmbedded),$("#folderPicker").toggle(!t&&Panopto.isEmbedded))},_handleSort:function(e){var t=this._getColumnData(e),s=t.sortSettings.currentAscending;void 0===s&&(s=t.sortSettings.defaultAscending),this.queryParams.sortColumn==t.column&&(s=!s),Panopto.Application.defaultInstance.updateState({sortColumn:e,sortAscending:s,page:null})},_setSort:function(e,t,s){this.queryParams.sortColumn=e,this.queryParams.sortAscending=t,this._sortDropDownProps={...this._sortDropDownProps,sortOptions:this._getSortOptions(),selectedOptionId:e,sortDirection:t?"ascending":"descending"},this._actionHeader?.setProps({sortDropDownProps:this._sortDropDownProps});var o=this._getColumnData(e);o.sortSettings.currentAscending=t,s||this.setSortSetting(o),this._indicateSort()},_getSortOptions:function(){return this._columnData.filter((({column:e})=>this.isColumnSortable(e))).map((({column:e,sortSettings:t})=>({id:e,name:Sys.converters.displayColumnName(e),forceDirection:t.forceDirection})))},_getColumnData:function(e){return $.grep(this._columnData,(t=>t.column==e))[0]},setDefaultSort:function(){this._setSort(this._defaultSortColumn,this._defaultSortAscending,!0)},_indicateSort:function(){$(".ascending-header").removeClass("ascending-header").removeAttr("aria-sort"),$(".descending-header").removeClass("descending-header").removeAttr("aria-sort");var e=$get("listViewHeader-"+this.queryParams.sortColumn);this.queryParams.sortAscending?$(e).addClass("ascending-header").attr("aria-sort","ascending"):$(e).addClass("descending-header").attr("aria-sort","descending")},setPage:function(e){this.queryParams.page=e,this._pagingFooterComponent.setProps({page:e})},setDates:function(e,t){this.queryParams.startDate=e,this.queryParams.endDate=t;let s=e?moment(e,"MM/DD/YYYY"):null,o=t?moment(t,"MM/DD/YYYY"):null;s&&!s?.isValid()&&(s=null),o&&!o?.isValid()&&(o=null),this._dateFilterProps={...this._dateFilterProps,dateRange:[s,o]},this._actionHeader?.setProps({dateFilterProps:this._dateFilterProps}),Panopto.DateRangePicker.setDates(e,t)},setResultsSize:function(e){this.queryParams.maxResults=e,this._pagingFooterComponent.setProps({rowsPerPage:e})},updateData:function(e,t){var s=this._interface?this._interface(this.queryParams):{queryParameters:this.queryParams};e||$("#loadingMessage").show(),this._resultsDataContext||(this._resultsDataContext=Sys.create.dataContext({serviceUri:Panopto.Util.c_dataServiceUrl,saveOperation:this._saveOperation})),this._resultsDataContext.clearData(),this._lastListRequest?.abort();var o=()=>{$("#loadingMessage").hide(),t||(this._resultsDataView.set_data([]),this._totalRows=0,this._showNoResultsMessage(!0,!0))};const a=PanoptoCore.createAbortToken();this._fetchData(s,(e=>this._dataFetched(e)),(()=>o()),a.signal),this._lastListRequest=a},_fetchData:function(e,t,s,o){PanoptoApiClient.doFetchWcfApi({methodName:this._fetchDataMethodName,data:e,abortSignal:o}).then(t).catch(s)},_dataFetched:function(e){this._totalRows=e.TotalNumber;var t=e.Results;this._resultsDataContext.trackData(t),this._resultsDataView.set_data(t),$(".selectall").prop("checked",!1),$("#resultsDiv").scrollTop(0),this._showNoResultsMessage(!this._totalRows),$("#searchResultsAria").text(1===t.length?Panopto.GlobalResources.Controls_ClientList_SearchResultSingularAria:PanoptoTS.StringHelpers.format(Panopto.GlobalResources.Controls_ClientList_SearchResultPluralAria,t.length)),this._showPagingInfo(),$("#loadingMessage").hide(),this._matchHeaderAndContentTableWidths()},_showPagingInfo:function(){if(this._pagingFooterComponent.setProps({count:this._totalRows,page:this.queryParams.page}),Panopto.isEmbedded){const e=_.first(this._pageSizes);this._totalRows<e&&$(".pagination").hide(),this._handleResize()}},_getCurrentPageIndexRange:function(){var e=this.queryParams.page*this.queryParams.maxResults+1,t=e+this.queryParams.maxResults-1;return{Start:e,End:this.queryParams.maxResults?Math.min(t,this._totalRows):this._totalRows}},_createNoResultsMessage:function(e){var t=$(e).clone().attr("id","noResultsMessage").removeClass("sys-template").appendTo("#noResultsPlaceholder");return Panopto.Core.UI.Handlers.button($(".retry-link"),(()=>this.updateData(!1)),{allowPropagation:!0}),t},_showNoResultsMessage:function(e,t,s,o){let a,i=Panopto.user.somewherePermissions[PanoptoTS.Core.Permission.SessionCreate]&&!Panopto.isHostedMaster;if($("#noResultsPlaceholder").empty(),t||!1===e||s?($(".content-header").show(),$("#sortHeaderDataView").show(),$("#pageBody .pagination").show()):($(".content-header").hide(),$("#sortHeaderDataView").hide(),$("#pageBody .pagination").hide()),!1!==e){if(a=t?"#noResultsErrorTemplate":Panopto.user.isAuthenticated?"folder"===o?"#noFolderTemplate":this._isFilterApplied()?"#noResultsQueryTemplate":"myFolder"===o?"#emptyMyFolderTemplate":this.queryParams.folderID?"#emptyFolderTemplate":"bookmarks"===o?"#noBookmarksTemplate":"sharedWithMe"===o?"#noSharedWithMeTemplate":i?"#noResultsTemplateCreator":"#noResultsTemplateViewer":"#noResultsLoginTemplate",a)var n=this._createNoResultsMessage(a);if(t){var r=$("a",n)[0];Panopto.Core.UI.Handlers.button($(r),(()=>this.updateData(!1)),{allowPropagation:!0})}else if(!Panopto.user.isAuthenticated)if(Panopto.features.usePanoptoState)Panopto.Application.setPanoptoState(window.location.href).then((e=>{let t=Panopto.appRoot+"/Pages/Auth/Login.aspx?panoptoState="+e?.panoptoStateId;$("a",n).attr("href",t)}));else{var l=Panopto.appRoot+"/Pages/Auth/Login.aspx?ReturnUrl="+encodeURIComponent(window.location.href);$("a",n).attr("href",l)}}},_isFilterApplied:function(){return this.queryParams.query||this.queryParams.startDate&&this.queryParams.endDate},_batchEdit:function(e,t){var s={move:Panopto.GlobalResources.Move,copy:Panopto.GlobalResources.Copy,reference:Panopto.GlobalResources.Reference},o={editType:e,folderID:this.queryParams.folderID};Panopto.ModalPopup.defaultInstance.modalArguments({batchItems:t}),Panopto.Application.defaultInstance.updateState({modalPage:"BatchEdit",modalHeader:s[e],modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString(o)})},_batchShare:function(e){Panopto.Application.defaultInstance.updateState({modalPage:"BatchShare",modalHeader:Panopto.GlobalResources.BatchShare})},_batchDelete:function(e,t){this._onBatchDeleting&&this._onBatchDeleting(e);const s=()=>{var t=this._resultsDataView.get_data().slice(),s=[];$.each(e,((e,o)=>{this._resultsDataContext.removeEntity(o),s.push(o),t.splice(t.indexOf(o),1)})),this._resultsDataView.set_data(t),$("#loadingMessage").show(),this._deleteCall?this._deleteCall(s):this._resultsDataContextSaveWithReporting(s),this._resultsDataContext.trackData(t)},o=t||String.format(this._batchDeleteMessage,e.length);PanoptoReactComponents.Dialogs.PanoptoConfirmController.confirm({message:o,confirmMessage:Panopto.GlobalResources.Yes,cancelMessage:Panopto.GlobalResources.Cancel,onClose:e=>{e&&s()}})},_refresh:function(){this.updateData(!1)},_addActionButtons:function(e,t,s,o){var a=t.PlayableObjectType===Panopto.Core.PlayableObjectType.Playlist,i=[],n=this,r=(s=s||{}).addShare,l=s.addStats,c=s.addNotes,h=s.addSettings,d=s.addDelete,u=s.addEdit,p=s.addLog,g=s.addManage,P=s.addRestore,m=s.addRestoreFromArchive,S=s.addRemovePermanently,b=s.addPublish,f=s.addJoin,w=s.addArchivedLog,D=(o=o||{}).deleteTitle;t.Permissions[PanoptoTS.Core.Permission.SessionShareAccessControlPolicyEnumerate]&&!Panopto.isHostedMaster&&r&&i.push("Share");const v=t.Status===Panopto.Data.SessionStatus.Complete||t.Status>=Panopto.Data.SessionStatus.Recording&&t.IsBroadcast;return t.Permissions[PanoptoTS.Core.Permission.SessionViewAnalytics]&&v&&!Panopto.features.disableFeaturesRequiringExternalNetworkAccess&&l&&(!a||Panopto.features.playlistStatsEnabled&&Panopto.user.sitePermissions[PanoptoTS.Core.Permission.SiteViewAnalytics])&&i.push("Stats"),Panopto.isHostedMaster||t.Status!=Panopto.Data.SessionStatus.Recording&&t.Status!=Panopto.Data.SessionStatus.Live||!Panopto.user.isAuthenticated||!c||i.push("Notes"),h&&(a?t.Permissions[PanoptoTS.Core.Permission.PlaylistEditMetadata]:t.Permissions[PanoptoTS.Core.Permission.SessionViewMetadata]||t.Permissions[PanoptoTS.Core.Permission.SessionManageApprovalState])&&i.push("Settings"),t.Permissions[PanoptoTS.Core.Permission.SessionViewMetadata]&&g&&i.push("Manage"),(a&&t.Permissions[PanoptoTS.Core.Permission.PlaylistDelete]||!a&&t.Permissions[PanoptoTS.Core.Permission.SessionDelete])&&d&&i.push("Delete"),t.IsEditable&&t.Permissions[PanoptoTS.Core.Permission.SessionEditContent]&&u&&i.push("Edit"),t.Permissions[PanoptoTS.Core.Permission.SessionViewLogs]&&p&&i.push("Log"),t.Permissions[PanoptoTS.Core.Permission.SessionRestore]&&P&&i.push("Restore"),m&&Panopto.user.isAuthenticated&&t.IsArchived&&!t.ArchiveEstimatedRestoreTime&&i.push("RestoreFromArchive"),t.Permissions[PanoptoTS.Core.Permission.SessionEraseRestrictedToOwner]&&S&&i.push("RemovePermanently"),t.Permissions[PanoptoTS.Core.Permission.SessionRequestApproval]&&t.AvailabilityMessage&&!t.SessionGroupRequiresApproval&&b&&i.push("Publish"),Panopto.features.enableCaptureLive&&Panopto.features.showCaptureLiveButton&&t.Permissions[PanoptoTS.Core.Permission.SessionAccessWebRtcStreaming]&&t.Permissions[PanoptoTS.Core.Permission.SessionEditContent]&&(t.Status===Panopto.Data.SessionStatus.Created&&t.IsBroadcast||t.Status===Panopto.Data.SessionStatus.Live)&&f&&i.push("JoinWebcast"),Panopto.features.enableCaptureLive&&Panopto.features.showCaptureLiveButton&&t.Permissions[PanoptoTS.Core.Permission.SessionAccessWebRtcStreaming]&&t.Permissions[PanoptoTS.Core.Permission.SessionEditContent]&&(t.Status===Panopto.Data.SessionStatus.Created&&!t.IsBroadcast||t.Status===Panopto.Data.SessionStatus.Recording)&&f&&i.push("JoinRecording"),t.Permissions[PanoptoTS.Core.Permission.SessionViewLogs]&&w&&i.push("ArchivedLog"),a?Panopto.UI.Playlist.actionButtons($(e),$(".action-btns",e),{deliveryId:t.DeliveryID,sessionId:t.SessionID,name:Panopto.Util.displayDeliveryName(t),viewerUrl:t.ViewerUrl},!1,{availableActions:i,showLabels:!0,listCss:"session-action-list",deleteActivate:function(){n._batchDelete([t],n._deleteMessage)},restoreActivate:function(){n._batchRestore&&n._batchRestore([t])},removePermanentlyActivate:function(){n._batchRemovePermanently&&n._batchRemovePermanently([t])},overrideDefaultHover:!0,deleteTitle:D}):Panopto.UI.Session.actionButtons($(e),$(".action-btns",e),{deliveryId:t.DeliveryID,sessionId:t.SessionID,name:Panopto.Util.displayDeliveryName(t),isBroadcasting:t.IsBroadcast&&t.Status===Panopto.Data.SessionStatus.Live,editorUrl:t.EditorUrl,viewerUrl:t.ViewerUrl,notesUrl:t.NotesUrl,logUrl:t.DeliveryID,availabilityWindowStart:t.AvailabilityWindowStart,availabilityWindowEnd:t.AvailabilityWindowEnd},!1,{availableActions:i,showLabels:!0,listCss:"session-action-list",deleteActivate:function(){n._batchDelete([t],n._deleteMessage)},restoreActivate:function(){n._batchRestore&&n._batchRestore([t])},restoreFromArchiveActivate:function(){n._batchRestoreFromArchive&&n._batchRestoreFromArchive([t])},removePermanentlyActivate:function(){n._batchRemovePermanently&&n._batchRemovePermanently([t])},publishActivate:function(){n._publish(t)},overrideDefaultHover:!0,deleteTitle:D}),_.any(i)},_batchErrorAlert:function(e,t,s,o,a){let i,n=String.format(e,s.length,o);$.each(s,((e,o)=>{if(10===e)return n+="\n\n    ",n+=String.format(t,s.length-10),!1;i=a(o),n+=String.format("\n\n   {0}\n        {1}",i,o.Message)})),alert(n)},_getItemName:function(e){return e.Name},_getDefaultSort:function(e){return this._defaultSortColumn},_resultsDataContextSaveWithReporting:function(e){var t,s=void 0!==this._deleteOperation,o=this._getID,a=this,i=i=>{i&&i.ItemFailedCount&&(t=$.grep(i.ItemResults,(e=>!e.Succeeded)),s?this._batchErrorAlert(Panopto.GlobalResources.ListBase_js_ErrorDeletingItems,Panopto.GlobalResources.ListBase_js_BatchDeleteErrorMore,t,e.length,(function(t){let s=$.grep(e,(e=>o(e)===t.Description)),i="";return s.length&&(i=Panopto.Core.TextHelpers.cleanTextWithoutHighlighting(a._getItemName(s[0]))),i})):this._batchErrorAlert(Panopto.GlobalResources.ListBase_js_ErrorDeletingItems,Panopto.GlobalResources.ListBase_js_BatchDeleteErrorMore,i.ItemFailedCount,e.length,(e=>e.Name))),this.updateData(),"GetFolders"!==this._fetchDataMethodName&&"GetSessions"!==this._fetchDataMethodName||Panopto.NavBar.defaultInstance.refresh()},n=()=>{this._resultsDataContext._hasChanges||(alert(Panopto.GlobalResources.ListBase_js_ServerErrorDeletingItems),this.updateData())};if(s){var r={toDelete:$.map(e,(function(e){return o(e)}))};PanoptoApiClient.doFetchWcfApi({methodName:this._deleteOperation,data:r}).then((e=>i(e))).catch((()=>n()))}else this._resultsDataContext.saveChanges(i,n)},_checkBatchButtons:function(){var e=this._resultsDataView.get_data(),t=0,s=0;e&&(s=$.grep(e,(e=>e.selected)).length,t=$(".content-table input:checkbox").length,$(".selectall").prop("checked",t>0&&s==t));var o=s>0;$(".content-table, #sortHeaderDataView").toggleClass("batch-select",o),this._enableBatchDelete=o&&this._hasBatchDeleteButton&&e.some((e=>!e.Permissions||e.Permissions[PanoptoTS.Core.Permission.FolderDelete]||e.Permissions[PanoptoTS.Core.Permission.SessionDelete]||e.Permissions[PanoptoTS.Core.Permission.PlaylistDelete])),this._enableBatchCopy=o&&this._hasBatchEditButton&&Panopto.user.bulkOperationsEnabled&&e.some((e=>!e.Permissions||e.Permissions[PanoptoTS.Core.Permission.FolderEdit]||e.Permissions[PanoptoTS.Core.Permission.SessionCopySource]||e.Permissions[PanoptoTS.Core.Permission.SessionReferenceSource])),this._enableBatchMove=o&&this._hasBatchEditButton&&e.some((e=>!e.Permissions||e.Permissions[PanoptoTS.Core.Permission.FolderMove]||e.Permissions[PanoptoTS.Core.Permission.SessionMoveSource])),this._enableBatchShare=o&&this._hasBatchShareButton&&e.some((e=>!e.Permissions||e.Permissions[PanoptoTS.Core.Permission.FolderAccessControlPolicyEdit]||e.Permissions[PanoptoTS.Core.Permission.SessionShareAccessControlPolicyEnumerate])),$("#batchDeleteButton").toggleClass("hidden-command-button",!this._enableBatchDelete),this._batchSelectionProps={...this._batchSelectionProps,selectAll:s===t,selectionCount:s,shareEnabled:this._enableBatchShare,copyEnabled:this._enableBatchCopy,moveEnabled:this._enableBatchMove,deleteEnabled:this._enableBatchDelete},this._actionHeader?.setProps({showBatchSelection:o,batchSelectionProps:this._batchSelectionProps}),this._enableBatchButtons&&this._enableBatchButtons(o),this._handleResize()},_initializeColumnSortData:function(){$.each(this._columnData,((e,t)=>{t.sortSettings=t.sortSettings||{},t.sortSettings.sortable=t.sortSettings.sortable||void 0===t.sortSettings.sortable,t.sortSettings.defaultAscending=t.sortSettings.defaultAscending||void 0===t.sortSettings.defaultAscending,t.sortSettings.showInTableView=t.sortSettings.showInTableView||void 0===t.sortSettings.showInTableView,t.sortSettings.showInListView=t.sortSettings.showInListView||void 0===t.sortSettings.showInListView})),this._sortHeaderDataView.set_data(this._columnData)},_matchHeaderAndContentTableWidths:function(){var e=$("#tableViewContainer").width()-$("#sortHeaderDataView").outerWidth(!0);$("#tableHeader .spacer2").css("padding",0).width(Math.abs(e)).show()}},Panopto.ListBase.displayShortTaskStateMessage=function(e){var t=_.invert(Panopto.Core.ServiceInterface.Objects.TaskState)[e.state],s=String.format("TaskState_{0}",t),o=Panopto.GlobalResources[s]||s;return String.format(o,e.sourceFilename)},Panopto.ListBase.displaySubState=function(e){var t="SubStatus_"+Panopto.Core.ServiceInterface.Objects.ServiceTaskResourceMapping(e);return Panopto.GlobalResources[t]||Panopto.GlobalResources.SubStatus_MissingStatusString},Panopto.ListBase.highlightAndClean=function(e){return Panopto.Core.TextHelpers.highlightMatches(e,$.trim(Panopto.ListBase.currentQuery),"match")},Panopto.ListBase.registerClass("Panopto.ListBase");
//# sourceMappingURL=file://engfs.d.panopto.com/share/jenkinsbuilds/rel_rtc_14.13.0/14.13.0.00021/_PublishedWebsites/WebUI/Scripts/Panopto/List/ListBase.js.map
